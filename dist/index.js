// ==UserScript==
// @name              genshinSeelieEx
// @name:zh           原神规划助手扩展
// @description       description
// @description:zh    描述
// @include           https://seelie.inmagi.com/*
// @require           https://cdn.jsdelivr.net/npm/core-js-bundle@3.9.1/index.js
// @grant             unsafeWindow
// @grant             GM_setValue
// @grant             GM_download
// @grant             GM_xmlhttpRequest
// @grant             GM_openInTab
// @grant             GM_getResourceText
// @resource          character    https://cdn.jsdelivr.net/gh/KeyPJ/seelieEx/src/data/character.json
// @resource          weapon    https://cdn.jsdelivr.net/gh/KeyPJ/seelieEx/src/data/weapon.json
// @author            KeyPJ
// @namespace         https://github.com/KeyPJ/seelieEx
// @icon              https://www.google.com/s2/favicons?domain=inmagi.com
// @version           1.0.2
// @connect           api-takumi.mihoyo.com
// @run-at            document-end
// @tag               value
// ==/UserScript==

(()=>{"use strict";const e=JSON.parse(GM_getResourceText("character")),t=JSON.parse(GM_getResourceText("weapon")),n=[{element_attr_id:1,name:"pyro"},{element_attr_id:2,name:"anemo"},{element_attr_id:3,name:"geo"},{element_attr_id:4,name:"electro"},{element_attr_id:5,name:"hydro"},{element_attr_id:6,name:"cryo"},{element_attr_id:7,name:"dendro"}],r=()=>vue.goals,o=(e,t,n,o)=>{let l=r();const c=l.map((e=>e.id)),i=Math.max(...c)+1||1,s=l.findIndex("character"==o?e=>e.type==o&&e.character==t:e=>e.type==o&&e.weapon==t),u=function(e,t){let n=a[0],r=1;for(let o of a){const{level:a}=o;if(!(e>=a))return r==a?(console.log(`米游社数据无法判断是否突破,请自行比较${t}是否已突破`),o):n;r=a,n=o}return n}(e,n);let d;if(s<0)d="character"==o?{type:o,character:t,current:u,goal:u,id:i}:{type:o,character:"",weapon:t,current:u,goal:u,id:i};else{const e=l[s],{goal:t}=e,{level:n,asc:r}=t,{level:o,asc:a}=u;d=Object.assign(Object.assign({},e),{current:u,goal:o>=n&&a>=r?u:t})}vue.addGoal(d)};const a=[{level:1,asc:0,text:"1"},{level:20,asc:0,text:"20"},{level:20,asc:1,text:"20 A"},{level:40,asc:1,text:"40"},{level:40,asc:2,text:"40 A"},{level:50,asc:2,text:"50"},{level:50,asc:3,text:"50 A"},{level:60,asc:3,text:"60"},{level:60,asc:4,text:"60 A"},{level:70,asc:4,text:"70"},{level:70,asc:5,text:"70 A"},{level:80,asc:5,text:"80"},{level:80,asc:6,text:"80 A"},{level:90,asc:6,text:"90"}];var l=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function l(e){try{i(r.next(e))}catch(e){a(e)}}function c(e){try{i(r.throw(e))}catch(e){a(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,c)}i((r=r.apply(e,t||[])).next())}))};const c=localStorage.getItem("mihoyoAccount");let i;c&&(i=JSON.parse(c));let{game_uid:s,region:u,accountIdx:d}=i||{game_uid:"",region:"cn_qd01",accountIdx:0};function m(e){return new Promise(((t,n)=>{GM_xmlhttpRequest({method:"GET",url:e,onload:e=>{if(200==e.status){const r=JSON.parse(e.responseText),{retcode:o,message:a,data:l}=r;0===o?t(l):n(a)}else n(e.responseText)},onerror:e=>{n(e)}})}))}console.log("mihoyoAccount"),console.log({game_uid:s,region:u,accountIdx:d});l(void 0,void 0,void 0,(function*(){var e,t;if(!s||!u){const e=yield l(void 0,void 0,void 0,(function*(){try{const{list:e}=yield m("https://api-takumi.mihoyo.com/binding/api/getUserGameRolesByCookie?game_biz=hk4e_cn");return e}catch(e){return console.error(e),alert("请确认已登录米哈游论坛且绑定原神账户!"),GM_openInTab("https://bbs.mihoyo.com/ys/"),[]}}));if(0===e.length)throw new Error("账户绑定角色信息获取失败!");d>=e.length&&(d=e.length-1);const{game_uid:t,region:n}=e[d];s=t,u="cn_gf01"==n?"cn_gf01":"cn_qd01",localStorage.setItem("mihoyoAccount",JSON.stringify({game_uid:s,region:u,accountIdx:d}))}const n=(yield((e,t)=>l(void 0,void 0,void 0,(function*(){const{list:n}=yield function(e,t){return new Promise(((n,r)=>{GM_xmlhttpRequest({method:"POST",url:"https://api-takumi.mihoyo.com/event/e20200928calculate/v1/sync/avatar/list",data:JSON.stringify({element_attr_ids:[],weapon_cat_ids:[],page:1,size:50,uid:e,region:t}),onload:e=>{if(200==e.status){const t=JSON.parse(e.responseText),{retcode:o,message:a,data:l}=t;0===o?n(l):r(a)}else r(e.responseText)},onerror:e=>{r(e)}})}))}(e,t);return n})))(s,u)).map((e=>((e,t,n)=>l(void 0,void 0,void 0,(function*(){const{id:r}=e,o=`?avatar_id=${r}&uid=${t}&region=${n}`;let a=yield m("https://api-takumi.mihoyo.com/event/e20200928calculate/v1/sync/avatar/detail"+o);return Object.assign({character:e},a)})))(e,s,u))),r=[];try{for(var o,a=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,o,(t=e[n](t)).done,t.value)}))}}}(n);!(o=yield a.next()).done;){let e=o.value;r.push(e)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=a.return)&&(yield t.call(a))}finally{if(e)throw e.error}}return r})).then((a=>{console.log(a),a.forEach((a=>{!function(a){const{character:l,skill_list:c,weapon:i}=a,{name:s,element_attr_id:u}=l;if(i){const{name:e,level_current:n}=i,r=(e=>{for(let n of t){const{id:t,name:r}=n;if(e==r)return t}return console.error(`getWeaponrId ${e} 查询失败`),""})(e);console.log(r,e),r&&o(n,r,e,"weapon")}const{level_current:d}=l,m=(t=>{for(let n of e){const{id:e,name:r}=n;if(t==r)return e}return console.error(`getCharacterId ${t} 查询失败`),""})(s);if(!m)return;o(d,m,s,"character");let v=m;"traveler"==m&&(v=`traveler_${(e=>{for(let t of n){const{element_attr_id:n,name:r}=t;if(e==n)return r}return console.error(`getElementAttrName: ${e} 查询失败`),""})(u)}`),((e,t)=>{const n=r(),o=n.map((e=>e.id)),a=Math.max(...o)+1||1,l=n.findIndex((t=>"talent"==t.type&&t.character==e)),{level_current:c}=t[0],{level_current:i}=t[1],{level_current:s}=t[2];let u;if(l<0)u={type:"talent",character:e,c3:!1,c5:!1,normal:{current:c,goal:c},skill:{current:i,goal:i},burst:{current:s,goal:s},id:a};else{const e=n[l],{normal:t,skill:r,burst:o}=e,{goal:a}=t,{goal:d}=r,{goal:m}=o;u=Object.assign(Object.assign({},e),{normal:{current:c,goal:c>a?c:a},skill:{current:i,goal:i>d?i:d},burst:{current:s,goal:s>m?s:m}})}vue.addGoal(u)})(v,c)}(a)}))}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90YW1wZXJtb25rZXktd2VicGFjay10ZW1wbGF0ZS8uL3NyYy9jb25maWcudHMiLCJ3ZWJwYWNrOi8vdGFtcGVybW9ua2V5LXdlYnBhY2stdGVtcGxhdGUvLi9zcmMvcXVlcnkudHMiLCJ3ZWJwYWNrOi8vdGFtcGVybW9ua2V5LXdlYnBhY2stdGVtcGxhdGUvLi9zcmMvc2VlbGllLnRzIiwid2VicGFjazovL3RhbXBlcm1vbmtleS13ZWJwYWNrLXRlbXBsYXRlLy4vc3JjL2luZGV4LnRzIl0sIm5hbWVzIjpbImNoYXJhY3RlcnMiLCJKU09OIiwicGFyc2UiLCJHTV9nZXRSZXNvdXJjZVRleHQiLCJ3ZWFwb25zIiwiZWxlbWVudEF0dHJJZHMiLCJlbGVtZW50X2F0dHJfaWQiLCJuYW1lIiwiZ2V0VG90YWxHb2FsIiwidnVlIiwiZ29hbHMiLCJhZGRDaGFyYWN0ZXJHb2FsIiwibGV2ZWxfY3VycmVudCIsIm5hbWVFbiIsInR5cGUiLCJ0b3RhbEdvYWwiLCJpZHMiLCJtYXAiLCJnIiwiaWQiLCJNYXRoIiwibWF4IiwiY2hhcmFjdGVySWR4IiwiZmluZEluZGV4IiwiY2hhcmFjdGVyIiwid2VhcG9uIiwiY2hhcmFjdGVyU3RhdHVzIiwiaW5pdENoYXJhY3RlclN0YXR1cyIsImNoYXJhY3RlclN0YXR1c0xpc3QiLCJpbml0TGV2ZWwiLCJsZXZlbCIsImNvbnNvbGUiLCJsb2ciLCJjaGFyYWN0ZXJHb2FsIiwiY3VycmVudCIsImdvYWwiLCJzZWVsaWVHb2FsIiwiYXNjIiwibGV2ZWxDdXJyZW50IiwiYXNjQ3VycmVudCIsImFkZEdvYWwiLCJ0ZXh0IiwibWlob3lvQWNjb3VudFN0ciIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJtaWhveW9BY2NvdW50IiwiZ2FtZV91aWQiLCJyZWdpb24iLCJhY2NvdW50SWR4IiwibWFrZUdldFJlcXVlc3QiLCJ1cmwiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIkdNX3htbGh0dHBSZXF1ZXN0IiwibWV0aG9kIiwib25sb2FkIiwicmVzcG9uc2UiLCJzdGF0dXMiLCJyZXMiLCJyZXNwb25zZVRleHQiLCJyZXRjb2RlIiwibWVzc2FnZSIsImRhdGEiLCJvbmVycm9yIiwiZXJyb3IiLCJhY2NvdW50TGlzdCIsImxpc3QiLCJlcnIiLCJhbGVydCIsIkdNX29wZW5JblRhYiIsImxlbmd0aCIsIkVycm9yIiwiYVVpZCIsImFSZWdpb24iLCJzZXRJdGVtIiwic3RyaW5naWZ5IiwiZGV0YWlscyIsInVpZCIsImNoYXJhY3Rlckxpc3QiLCJtYWtlUG9zdFJlcXVlc3QiLCJnZXRDaGFyYWN0ZXJzIiwiYyIsInBhcmFtcyIsImNoYXJhY3RlckRhdGEiLCJnZXRDaGFyYWN0ZXJEZXRhaWwiLCJkZXRhaWxMaXN0IiwiZCIsInB1c2giLCJ0aGVuIiwiZm9yRWFjaCIsInYiLCJjaGFyYWN0ZXJEYXRhRXgiLCJza2lsbF9saXN0Iiwid2VhcG9uTGV2ZUwiLCJ3ZWFwb25JZCIsInF1ZXJ5TmFtZSIsImUiLCJnZXRXZWFwb25JZCIsImNoYXJhY3RlckxldmVsIiwiY2hhcmFjdGVySWQiLCJnZXRDaGFyYWN0ZXJJZCIsInRhbGVudENoYXJhY3RlciIsImdldEVsZW1lbnRBdHRyTmFtZSIsInRhbGVudElkeCIsIm5vcm1hbEN1cnJlbnQiLCJza2lsbEN1cnJlbnQiLCJidXJzdEN1cnJlbnQiLCJ0YWxlbnRHb2FsIiwiYzMiLCJjNSIsIm5vcm1hbCIsInNraWxsIiwiYnVyc3QiLCJub3JtYWxHb2FsIiwic2tpbGxHb2FsIiwiYnVyc3RHb2FsIiwiYWRkVGFsZW50R29hbCIsImFkZENoYXJhY3RlciJdLCJtYXBwaW5ncyI6Im1CQUVPLE1DR0RBLEVBQWFDLEtBQUtDLE1BQU1DLG1CQUFtQixjQUMzQ0MsRUFBVUgsS0FBS0MsTUFBTUMsbUJBQW1CLFdBd0J4Q0UsRUFBaUIsQ0FDbkIsQ0FBQ0MsZ0JBQWlCLEVBQUdDLEtBQU0sUUFDM0IsQ0FBQ0QsZ0JBQWlCLEVBQUdDLEtBQU0sU0FDM0IsQ0FBQ0QsZ0JBQWlCLEVBQUdDLEtB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QUVqRCxJQUFJZSxFQUNKLEdBQUlKLEVBQVksRUFDWkksRUFBYSxDQUNUOUYsS0FBTSxTQUNOVSxVQUFXOEUsRUFDWE8sSUFBSSxFQUNKQyxJQUFJLEVBQ0pDLE9BQVEsQ0FDSjdFLFFBQVN1RSxFQUNUdEUsS0FBTXNFLEdBRVZPLE1BQU8sQ0FDSDlFLFFBQVN3RSxFQUNUdkUsS0FBTXVFLEdBRVZPLE1BQU8sQ0FDSC9FLFFBQVN5RSxFQUNUeEUsS0FBTXdFLEdBRVZ4RixVQUVELENBQ0gsTUFBTWlCLEVBQWFyQixFQUFVeUYsSUFDdkIsT0FBQ08sRUFBTSxNQUFFQyxFQUFLLE1BQUVDLEdBQVM3RSxHQUN4QkQsS0FBTStFLEdBQWNILEdBQ3BCNUUsS0FBTWdGLEdBQWFILEdBQ25CN0UsS0FBTWlGLEdBQWFILEVBQzFCTCxFQUFhLE9BQUgsd0JBQ0h4RSxHQUFVLENBQ2IyRSxPQUFRLENBQ0o3RSxRQUFTdUUsRUFDVHRFLEtBQU1zRSxFQUFnQlMsRUFBYVQsRUFBZ0JTLEdBQ3BERixNQUFPLENBQ045RSxRQUFTd0UsRUFDVHZFLEtBQU11RSxFQUFlUyxFQUFZVCxFQUFlUyxHQUNqREYsTUFBTyxDQUNOL0UsUUFBU3lFLEVBQ1R4RSxLQUFNd0UsRUFBZVMsRUFBWVQsRUFBZVMsS0FLNUQzRyxJQUFJK0IsUUFBUW9FLElBa0ZaUyxDQUFjZixFQUFpQlQsR0NabkJ5QixDQUFhM0IsVSIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29uZmlnfSBmcm9tIFwiLi9AdHlwZVwiO1xyXG5cclxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcclxuICAgIGdhbWVfdWlkOiBcIlwiLC8vNTAxNzI1MTcyXHJcbiAgICByZWdpb246IFwiY25fcWQwMVwiLC8vXHJcbiAgICBhY2NvdW50SWR4OiAwXHJcbn0gYXMgQ29uZmlnO1xyXG4iLCJpbnRlcmZhY2UgcXVlcnlOYW1lIHtcclxuICAgIGlkOiBzdHJpbmcsXHJcbiAgICBuYW1lOiBzdHJpbmdcclxufVxyXG5cclxuY29uc3QgY2hhcmFjdGVycyA9IEpTT04ucGFyc2UoR01fZ2V0UmVzb3VyY2VUZXh0KFwiY2hhcmFjdGVyXCIpKSBhcyBxdWVyeU5hbWVbXTtcclxuY29uc3Qgd2VhcG9ucyA9IEpTT04ucGFyc2UoR01fZ2V0UmVzb3VyY2VUZXh0KFwid2VhcG9uXCIpKSBhcyBxdWVyeU5hbWVbXTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXRDaGFyYWN0ZXJJZCA9IChxdWVyeU5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgZm9yIChsZXQgZSBvZiBjaGFyYWN0ZXJzKSB7XHJcbiAgICAgICAgY29uc3Qge2lkLCBuYW1lfSA9IGVcclxuICAgICAgICBpZiAocXVlcnlOYW1lID09IG5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGlkO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbnNvbGUuZXJyb3IoYGdldENoYXJhY3RlcklkICR7cXVlcnlOYW1lfSDmn6Xor6LlpLHotKVgKVxyXG4gICAgcmV0dXJuIFwiXCJcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXRXZWFwb25JZCA9IChxdWVyeU5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgZm9yIChsZXQgZSBvZiB3ZWFwb25zKSB7XHJcbiAgICAgICAgY29uc3Qge2lkLCBuYW1lfSA9IGVcclxuICAgICAgICBpZiAocXVlcnlOYW1lID09IG5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGlkO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbnNvbGUuZXJyb3IoYGdldFdlYXBvbnJJZCAke3F1ZXJ5TmFtZX0g5p+l6K+i5aSx6LSlYClcclxuICAgIHJldHVybiBcIlwiXHJcbn07XHJcblxyXG5jb25zdCBlbGVtZW50QXR0cklkcyA9IFtcclxuICAgIHtlbGVtZW50X2F0dHJfaWQ6IDEsIG5hbWU6IFwicHlyb1wifSxcclxuICAgIHtlbGVtZW50X2F0dHJfaWQ6IDIsIG5hbWU6IFwiYW5lbW9cIn0sXHJcbiAgICB7ZWxlbWVudF9hdHRyX2lkOiAzLCBuYW1lOiBcImdlb1wifSxcclxuICAgIHtlbGVtZW50X2F0dHJfaWQ6IDQsIG5hbWU6IFwiZWxlY3Ryb1wifSxcclxuICAgIHtlbGVtZW50X2F0dHJfaWQ6IDUsIG5hbWU6IFwiaHlkcm9cIn0sXHJcbiAgICB7ZWxlbWVudF9hdHRyX2lkOiA2LCBuYW1lOiBcImNyeW9cIn0sXHJcbiAgICB7ZWxlbWVudF9hdHRyX2lkOiA3LCBuYW1lOiBcImRlbmRyb1wifSxcclxuXVxyXG5cclxuXHJcbmV4cG9ydCBjb25zdCBnZXRFbGVtZW50QXR0ck5hbWUgPSAocXVlcnlOYW1lOiBudW1iZXIpID0+IHtcclxuXHJcbiAgICBmb3IgKGxldCBlIG9mIGVsZW1lbnRBdHRySWRzKSB7XHJcbiAgICAgICAgY29uc3Qge2VsZW1lbnRfYXR0cl9pZCwgbmFtZX0gPSBlXHJcbiAgICAgICAgaWYgKHF1ZXJ5TmFtZSA9PSBlbGVtZW50X2F0dHJfaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc29sZS5lcnJvcihgZ2V0RWxlbWVudEF0dHJOYW1lOiAke3F1ZXJ5TmFtZX0g5p+l6K+i5aSx6LSlYClcclxuICAgIHJldHVybiBcIlwiXHJcbn07XHJcbiIsImltcG9ydCBHb2FsID0gc2VlbGllLkdvYWw7XHJcbmltcG9ydCB7bW9ob3lvfSBmcm9tIFwiLi9AdHlwZS9tb2hveW9cIjtcclxuaW1wb3J0IENoYXJhY3RlckRhdGFFeCA9IG1vaG95by5DaGFyYWN0ZXJEYXRhRXg7XHJcbmltcG9ydCBDaGFyYWN0ZXJTdGF0dXMgPSBzZWVsaWUuQ2hhcmFjdGVyU3RhdHVzO1xyXG5pbXBvcnQgQ2hhcmFjdGVyR29hbCA9IHNlZWxpZS5DaGFyYWN0ZXJHb2FsO1xyXG5pbXBvcnQgVGFsZW50R29hbCA9IHNlZWxpZS5UYWxlbnRHb2FsO1xyXG5pbXBvcnQge2dldENoYXJhY3RlcklkLCBnZXRFbGVtZW50QXR0ck5hbWUsIGdldFdlYXBvbklkfSBmcm9tIFwiLi9xdWVyeVwiO1xyXG5pbXBvcnQgV2VhcG9uR29hbCA9IHNlZWxpZS5XZWFwb25Hb2FsO1xyXG5cclxuXHJcbmV4cG9ydCBjb25zdCBnZXRUb3RhbEdvYWwgPSAoKSA9PiB7XHJcbiAgICAvLyBAdHMtaWdub3JlXHJcbiAgICBjb25zdCBnb2FsczogR29hbFtdID0gdnVlLmdvYWxzO1xyXG4gICAgcmV0dXJuIGdvYWxzO1xyXG59O1xyXG5cclxuY29uc3QgYWRkVGFsZW50R29hbCA9ICh0YWxlbnRDaGFyYWN0ZXI6IHN0cmluZywgc2tpbGxfbGlzdDogbW9ob3lvLlNraWxsW10pID0+IHtcclxuICAgIGNvbnN0IHRvdGFsR29hbDogR29hbFtdID0gZ2V0VG90YWxHb2FsKCk7XHJcbiAgICBjb25zdCBpZHMgPSB0b3RhbEdvYWwubWFwKGc9PmcuaWQpO1xyXG4gICAgY29uc3QgaWQgPSBNYXRoLm1heCguLi5pZHMpICsgMSB8fCAxO1xyXG4gICAgY29uc3QgdGFsZW50SWR4ID0gdG90YWxHb2FsLmZpbmRJbmRleChnID0+IGcudHlwZSA9PSBcInRhbGVudFwiICYmIGcuY2hhcmFjdGVyID09IHRhbGVudENoYXJhY3Rlcik7XHJcbiAgICBjb25zdCB7bGV2ZWxfY3VycmVudDogbm9ybWFsQ3VycmVudH0gPSBza2lsbF9saXN0WzBdO1xyXG4gICAgY29uc3Qge2xldmVsX2N1cnJlbnQ6IHNraWxsQ3VycmVudH0gPSBza2lsbF9saXN0WzFdO1xyXG4gICAgY29uc3Qge2xldmVsX2N1cnJlbnQ6IGJ1cnN0Q3VycmVudH0gPSBza2lsbF9saXN0WzJdO1xyXG5cclxuICAgIGxldCB0YWxlbnRHb2FsOiBUYWxlbnRHb2FsO1xyXG4gICAgaWYgKHRhbGVudElkeCA8IDApIHtcclxuICAgICAgICB0YWxlbnRHb2FsID0ge1xyXG4gICAgICAgICAgICB0eXBlOiBcInRhbGVudFwiLFxyXG4gICAgICAgICAgICBjaGFyYWN0ZXI6IHRhbGVudENoYXJhY3RlcixcclxuICAgICAgICAgICAgYzM6IGZhbHNlLFxyXG4gICAgICAgICAgICBjNTogZmFsc2UsXHJcbiAgICAgICAgICAgIG5vcm1hbDoge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudDogbm9ybWFsQ3VycmVudCxcclxuICAgICAgICAgICAgICAgIGdvYWw6IG5vcm1hbEN1cnJlbnRcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2tpbGw6IHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQ6IHNraWxsQ3VycmVudCxcclxuICAgICAgICAgICAgICAgIGdvYWw6IHNraWxsQ3VycmVudFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBidXJzdDoge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudDogYnVyc3RDdXJyZW50LFxyXG4gICAgICAgICAgICAgICAgZ29hbDogYnVyc3RDdXJyZW50XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGlkXHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBzZWVsaWVHb2FsID0gdG90YWxHb2FsW3RhbGVudElkeF0gYXMgVGFsZW50R29hbDtcclxuICAgICAgICBjb25zdCB7bm9ybWFsLCBza2lsbCwgYnVyc3R9ID0gc2VlbGllR29hbDtcclxuICAgICAgICBjb25zdCB7Z29hbDogbm9ybWFsR29hbH0gPSBub3JtYWw7XHJcbiAgICAgICAgY29uc3Qge2dvYWw6IHNraWxsR29hbH0gPSBza2lsbDtcclxuICAgICAgICBjb25zdCB7Z29hbDogYnVyc3RHb2FsfSA9IGJ1cnN0O1xyXG4gICAgICAgIHRhbGVudEdvYWwgPSB7XHJcbiAgICAgICAgICAgIC4uLnNlZWxpZUdvYWwsXHJcbiAgICAgICAgICAgIG5vcm1hbDoge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudDogbm9ybWFsQ3VycmVudCxcclxuICAgICAgICAgICAgICAgIGdvYWw6IG5vcm1hbEN1cnJlbnQgPiBub3JtYWxHb2FsID8gbm9ybWFsQ3VycmVudCA6IG5vcm1hbEdvYWxcclxuICAgICAgICAgICAgfSwgc2tpbGw6IHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQ6IHNraWxsQ3VycmVudCxcclxuICAgICAgICAgICAgICAgIGdvYWw6IHNraWxsQ3VycmVudCA+IHNraWxsR29hbCA/IHNraWxsQ3VycmVudCA6IHNraWxsR29hbFxyXG4gICAgICAgICAgICB9LCBidXJzdDoge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudDogYnVyc3RDdXJyZW50LFxyXG4gICAgICAgICAgICAgICAgZ29hbDogYnVyc3RDdXJyZW50ID4gYnVyc3RHb2FsID8gYnVyc3RDdXJyZW50IDogYnVyc3RHb2FsXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBAdHMtaWdub3JlXHJcbiAgICB2dWUuYWRkR29hbCh0YWxlbnRHb2FsKVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGFkZENoYXJhY3RlckdvYWwgPSAobGV2ZWxfY3VycmVudDogbnVtYmVyLCBuYW1lRW46IFN0cmluZywgbmFtZTogc3RyaW5nLCB0eXBlOiBzdHJpbmcpID0+IHtcclxuICAgIGxldCB0b3RhbEdvYWw6IEdvYWxbXSA9IGdldFRvdGFsR29hbCgpO1xyXG4gICAgY29uc3QgaWRzID0gdG90YWxHb2FsLm1hcChnPT5nLmlkKTtcclxuICAgIGNvbnN0IGlkID0gTWF0aC5tYXgoLi4uaWRzKSArIDEgfHwgMTtcclxuICAgIGxldCBjaGFyYWN0ZXJQcmVkaWNhdGUgPSAoZzogR29hbCkgPT4gZy50eXBlID09IHR5cGUgJiYgZy5jaGFyYWN0ZXIgPT0gbmFtZUVuO1xyXG4gICAgbGV0IHdlYXBvblByZWRpY2F0ZSA9IChnOiBHb2FsKSA9PiBnLnR5cGUgPT0gdHlwZSAmJiBnLndlYXBvbiA9PSBuYW1lRW47XHJcbiAgICBjb25zdCBjaGFyYWN0ZXJJZHggPSB0b3RhbEdvYWwuZmluZEluZGV4KHR5cGUgPT0gXCJjaGFyYWN0ZXJcIiA/IGNoYXJhY3RlclByZWRpY2F0ZSA6IHdlYXBvblByZWRpY2F0ZSk7XHJcbiAgICBjb25zdCBjaGFyYWN0ZXJTdGF0dXM6IENoYXJhY3RlclN0YXR1cyA9IGluaXRDaGFyYWN0ZXJTdGF0dXMobGV2ZWxfY3VycmVudCwgbmFtZSk7XHJcblxyXG4gICAgbGV0IGNoYXJhY3RlckdvYWw6IEdvYWxcclxuXHJcbiAgICBmdW5jdGlvbiBpbml0Q2hhcmFjdGVyR29hbCgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0eXBlLFxyXG4gICAgICAgICAgICBjaGFyYWN0ZXI6IG5hbWVFbixcclxuICAgICAgICAgICAgY3VycmVudDogY2hhcmFjdGVyU3RhdHVzLFxyXG4gICAgICAgICAgICBnb2FsOiBjaGFyYWN0ZXJTdGF0dXMsXHJcbiAgICAgICAgICAgIGlkXHJcbiAgICAgICAgfSBhcyBDaGFyYWN0ZXJHb2FsXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gaW5pdFdlYXBvbkdvYWwoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdHlwZSxcclxuICAgICAgICAgICAgY2hhcmFjdGVyOlwiXCIsXHJcbiAgICAgICAgICAgIHdlYXBvbjogbmFtZUVuLFxyXG4gICAgICAgICAgICBjdXJyZW50OiBjaGFyYWN0ZXJTdGF0dXMsXHJcbiAgICAgICAgICAgIGdvYWw6IGNoYXJhY3RlclN0YXR1cyxcclxuICAgICAgICAgICAgaWRcclxuICAgICAgICB9IGFzIFdlYXBvbkdvYWxcclxuICAgIH1cclxuXHJcbiAgICBpZiAoY2hhcmFjdGVySWR4IDwgMCkge1xyXG4gICAgICAgIGNoYXJhY3RlckdvYWwgPSB0eXBlID09IFwiY2hhcmFjdGVyXCIgPyBpbml0Q2hhcmFjdGVyR29hbCgpIDogaW5pdFdlYXBvbkdvYWwoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3Qgc2VlbGllR29hbCA9IHR5cGUgPT0gXCJjaGFyYWN0ZXJcIiA/IHRvdGFsR29hbFtjaGFyYWN0ZXJJZHhdIGFzIENoYXJhY3RlckdvYWwgOiB0b3RhbEdvYWxbY2hhcmFjdGVySWR4XSBhcyBXZWFwb25Hb2FsXHJcbiAgICAgICAgY29uc3Qge2dvYWx9ID0gc2VlbGllR29hbDtcclxuICAgICAgICBjb25zdCB7bGV2ZWwsIGFzY30gPSBnb2FsO1xyXG4gICAgICAgIGNvbnN0IHtsZXZlbDogbGV2ZWxDdXJyZW50LCBhc2M6IGFzY0N1cnJlbnR9ID0gY2hhcmFjdGVyU3RhdHVzO1xyXG5cclxuICAgICAgICBjaGFyYWN0ZXJHb2FsID0ge1xyXG4gICAgICAgICAgICAuLi5zZWVsaWVHb2FsLFxyXG4gICAgICAgICAgICBjdXJyZW50OiBjaGFyYWN0ZXJTdGF0dXMsXHJcbiAgICAgICAgICAgIGdvYWw6IGxldmVsQ3VycmVudCA+PSBsZXZlbCAmJiBhc2NDdXJyZW50ID49IGFzYyA/IGNoYXJhY3RlclN0YXR1cyA6IGdvYWwsXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgdHlwZSA9PSBcImNoYXJhY3RlclwiID92dWUuYWRkR29hbChjaGFyYWN0ZXJHb2FsIGFzIENoYXJhY3RlckdvYWwpOnZ1ZS5hZGRHb2FsKGNoYXJhY3RlckdvYWwgYXMgV2VhcG9uR29hbClcclxufTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhZGRDaGFyYWN0ZXIoY2hhcmFjdGVyRGF0YUV4OiBDaGFyYWN0ZXJEYXRhRXgpIHtcclxuXHJcbiAgICBjb25zdCB7Y2hhcmFjdGVyLCBza2lsbF9saXN0LCB3ZWFwb259ID0gY2hhcmFjdGVyRGF0YUV4O1xyXG4gICAgY29uc3Qge25hbWUsIGVsZW1lbnRfYXR0cl9pZH0gPSBjaGFyYWN0ZXI7XHJcblxyXG4gICAgLy97XCJ0eXBlXCI6XCJjaGFyYWN0ZXJcIixcImNoYXJhY3RlclwiOlwidHJhdmVsZXJcIixcImN1cnJlbnRcIjp7XCJsZXZlbFwiOjcwLFwiYXNjXCI6NCxcInRleHRcIjpcIjcwXCJ9LFwiZ29hbFwiOntcImxldmVsXCI6NzAsXCJhc2NcIjo0LFwidGV4dFwiOlwiNzBcIn0sXCJpZFwiOjF9LFxyXG4gICAgLy97XCJ0eXBlXCI6XCJ3ZWFwb25cIixcIndlYXBvblwiOlwiXCJkZWF0aG1hdGNoXCJcIixcImN1cnJlbnRcIjp7XCJsZXZlbFwiOjcwLFwiYXNjXCI6NCxcInRleHRcIjpcIjcwXCJ9LFwiZ29hbFwiOntcImxldmVsXCI6NzAsXCJhc2NcIjo0LFwidGV4dFwiOlwiNzBcIn0sXCJpZFwiOjF9LFxyXG4gICAgLy97XCJ0eXBlXCI6XCJ0YWxlbnRcIixcImNoYXJhY3RlclwiOlwidHJhdmVsZXJfZ2VvXCIsXCJjM1wiOmZhbHNlLFwiYzVcIjpmYWxzZSxcIm5vcm1hbFwiOntcImN1cnJlbnRcIjoxLFwiZ29hbFwiOjZ9LFwic2tpbGxcIjp7XCJjdXJyZW50XCI6MSxcImdvYWxcIjo2fSxcImJ1cnN0XCI6e1wiY3VycmVudFwiOjEsXCJnb2FsXCI6Nn0sXCJpZFwiOjJ9XHJcblxyXG4gICAgaWYgKHdlYXBvbikge1xyXG4gICAgICAgIGNvbnN0IHtuYW1lLCBsZXZlbF9jdXJyZW50OiB3ZWFwb25MZXZlTH0gPSB3ZWFwb247XHJcbiAgICAgICAgY29uc3Qgd2VhcG9uSWQgPSBnZXRXZWFwb25JZChuYW1lKTtcclxuICAgICAgICBjb25zb2xlLmxvZyh3ZWFwb25JZCxuYW1lKTtcclxuICAgICAgICBpZiAod2VhcG9uSWQpIHtcclxuICAgICAgICAgICAgYWRkQ2hhcmFjdGVyR29hbCh3ZWFwb25MZXZlTCwgd2VhcG9uSWQsIG5hbWUsIFwid2VhcG9uXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbnN0IHtsZXZlbF9jdXJyZW50OiBjaGFyYWN0ZXJMZXZlbH0gPSBjaGFyYWN0ZXI7XHJcbiAgICBjb25zdCBjaGFyYWN0ZXJJZCA9IGdldENoYXJhY3RlcklkKG5hbWUpO1xyXG4gICAgaWYgKCFjaGFyYWN0ZXJJZCl7XHJcbiAgICAgICAgcmV0dXJuXHJcbiAgICB9XHJcbiAgICBhZGRDaGFyYWN0ZXJHb2FsKGNoYXJhY3RlckxldmVsLCBjaGFyYWN0ZXJJZCwgbmFtZSwgXCJjaGFyYWN0ZXJcIik7XHJcblxyXG4gICAgbGV0IHRhbGVudENoYXJhY3RlciA9IGNoYXJhY3RlcklkO1xyXG4gICAgaWYgKGNoYXJhY3RlcklkID09IFwidHJhdmVsZXJcIikge1xyXG4gICAgICAgIGNvbnN0IGVsZW1lbnRBdHRyTmFtZSA9IGdldEVsZW1lbnRBdHRyTmFtZShlbGVtZW50X2F0dHJfaWQpO1xyXG4gICAgICAgIHRhbGVudENoYXJhY3RlciA9IGB0cmF2ZWxlcl8ke2VsZW1lbnRBdHRyTmFtZX1gO1xyXG4gICAgfVxyXG4gICAgYWRkVGFsZW50R29hbCh0YWxlbnRDaGFyYWN0ZXIsIHNraWxsX2xpc3QpO1xyXG5cclxufVxyXG5cclxuY29uc3QgY2hhcmFjdGVyU3RhdHVzTGlzdDogQ2hhcmFjdGVyU3RhdHVzW10gPSBbXHJcbiAgICB7bGV2ZWw6IDEsIGFzYzogMCwgdGV4dDogXCIxXCJ9LFxyXG4gICAge2xldmVsOiAyMCwgYXNjOiAwLCB0ZXh0OiBcIjIwXCJ9LFxyXG4gICAge2xldmVsOiAyMCwgYXNjOiAxLCB0ZXh0OiBcIjIwIEFcIn0sXHJcbiAgICB7bGV2ZWw6IDQwLCBhc2M6IDEsIHRleHQ6IFwiNDBcIn0sXHJcbiAgICB7bGV2ZWw6IDQwLCBhc2M6IDIsIHRleHQ6IFwiNDAgQVwifSxcclxuICAgIHtsZXZlbDogNTAsIGFzYzogMiwgdGV4dDogXCI1MFwifSxcclxuICAgIHtsZXZlbDogNTAsIGFzYzogMywgdGV4dDogXCI1MCBBXCJ9LFxyXG4gICAge2xldmVsOiA2MCwgYXNjOiAzLCB0ZXh0OiBcIjYwXCJ9LFxyXG4gICAge2xldmVsOiA2MCwgYXNjOiA0LCB0ZXh0OiBcIjYwIEFcIn0sXHJcbiAgICB7bGV2ZWw6IDcwLCBhc2M6IDQsIHRleHQ6IFwiNzBcIn0sXHJcbiAgICB7bGV2ZWw6IDcwLCBhc2M6IDUsIHRleHQ6IFwiNzAgQVwifSxcclxuICAgIHtsZXZlbDogODAsIGFzYzogNSwgdGV4dDogXCI4MFwifSxcclxuICAgIHtsZXZlbDogODAsIGFzYzogNiwgdGV4dDogXCI4MCBBXCJ9LFxyXG4gICAge2xldmVsOiA5MCwgYXNjOiA2LCB0ZXh0OiBcIjkwXCJ9LFxyXG5dXHJcblxyXG5mdW5jdGlvbiBpbml0Q2hhcmFjdGVyU3RhdHVzKGxldmVsX2N1cnJlbnQ6IG51bWJlciwgbmFtZTogc3RyaW5nKSB7XHJcbiAgICBsZXQgaW5pdENoYXJhY3RlclN0YXR1cyA9IGNoYXJhY3RlclN0YXR1c0xpc3RbMF07XHJcbiAgICBsZXQgaW5pdExldmVsID0gMTtcclxuICAgIGZvciAobGV0IGNoYXJhY3RlclN0YXR1cyBvZiBjaGFyYWN0ZXJTdGF0dXNMaXN0KSB7XHJcbiAgICAgICAgY29uc3Qge2xldmVsfSA9IGNoYXJhY3RlclN0YXR1cztcclxuICAgICAgICBpZiAobGV2ZWxfY3VycmVudCA+PSBsZXZlbCkge1xyXG4gICAgICAgICAgICBpbml0TGV2ZWwgPSBsZXZlbFxyXG4gICAgICAgICAgICBpbml0Q2hhcmFjdGVyU3RhdHVzID0gY2hhcmFjdGVyU3RhdHVzXHJcbiAgICAgICAgICAgIGNvbnRpbnVlXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpbml0TGV2ZWwgPT0gbGV2ZWwpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYOexs+a4uOekvuaVsOaNruaXoOazleWIpOaWreaYr+WQpueqgeegtCzor7foh6rooYzmr5TovoMke25hbWV95piv5ZCm5bey56qB56C0YClcclxuICAgICAgICAgICAgcmV0dXJuIGNoYXJhY3RlclN0YXR1c1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpbml0Q2hhcmFjdGVyU3RhdHVzO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJldHVybiBpbml0Q2hhcmFjdGVyU3RhdHVzO1xyXG59XHJcblxyXG5cclxuIiwiaW1wb3J0IHttb2hveW99IGZyb20gXCIuL0B0eXBlL21vaG95b1wiO1xyXG5pbXBvcnQgUmVzID0gbW9ob3lvLlJlcztcclxuaW1wb3J0IFJvbGUgPSBtb2hveW8uUm9sZTtcclxuaW1wb3J0IERhdGEgPSBtb2hveW8uRGF0YTtcclxuaW1wb3J0IENoYXJhY3RlciA9IG1vaG95by5DaGFyYWN0ZXI7XHJcbmltcG9ydCBDaGFyYWN0ZXJEYXRhID0gbW9ob3lvLkNoYXJhY3RlckRhdGE7XHJcbmltcG9ydCBDaGFyYWN0ZXJEYXRhRXggPSBtb2hveW8uQ2hhcmFjdGVyRGF0YUV4O1xyXG5pbXBvcnQge2NvbmZpZ30gZnJvbSBcIi4vY29uZmlnXCI7XHJcbmltcG9ydCB7Q29uZmlnfSBmcm9tIFwiLi9AdHlwZVwiO1xyXG5pbXBvcnQge2FkZENoYXJhY3Rlcn0gZnJvbSBcIi4vc2VlbGllXCI7XHJcblxyXG5jb25zdCBtaWhveW9BY2NvdW50U3RyID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJtaWhveW9BY2NvdW50XCIpO1xyXG5sZXQgbWlob3lvQWNjb3VudDtcclxuaWYgKG1paG95b0FjY291bnRTdHIpIHtcclxuICAgIG1paG95b0FjY291bnQgPSBKU09OLnBhcnNlKG1paG95b0FjY291bnRTdHIpIGFzIENvbmZpZ1xyXG59XHJcbmxldCB7Z2FtZV91aWQsIHJlZ2lvbiwgYWNjb3VudElkeH0gPSBtaWhveW9BY2NvdW50IHx8IGNvbmZpZ1xyXG5jb25zb2xlLmxvZyhcIm1paG95b0FjY291bnRcIik7XHJcbmNvbnNvbGUubG9nKHtnYW1lX3VpZCwgcmVnaW9uLCBhY2NvdW50SWR4fSk7XHJcblxyXG5jb25zdCBCQlNfVVJMID0gJ2h0dHBzOi8vYmJzLm1paG95by5jb20veXMvJ1xyXG5jb25zdCBST0xFX1VSTCA9ICdodHRwczovL2FwaS10YWt1bWkubWlob3lvLmNvbS9iaW5kaW5nL2FwaS9nZXRVc2VyR2FtZVJvbGVzQnlDb29raWU/Z2FtZV9iaXo9aGs0ZV9jbidcclxuY29uc3QgQ0hBUkFDVEVSU19VUkwgPSAnaHR0cHM6Ly9hcGktdGFrdW1pLm1paG95by5jb20vZXZlbnQvZTIwMjAwOTI4Y2FsY3VsYXRlL3YxL3N5bmMvYXZhdGFyL2xpc3QnXHJcbmNvbnN0IENIQVJBQ1RFUlNfREVUQUlMX1VSTCA9ICdodHRwczovL2FwaS10YWt1bWkubWlob3lvLmNvbS9ldmVudC9lMjAyMDA5MjhjYWxjdWxhdGUvdjEvc3luYy9hdmF0YXIvZGV0YWlsJ1xyXG5cclxuZnVuY3Rpb24gbWFrZUdldFJlcXVlc3QodXJsOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgR01feG1saHR0cFJlcXVlc3Qoe1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXHJcbiAgICAgICAgICAgIHVybDogdXJsLFxyXG4gICAgICAgICAgICBvbmxvYWQ6IHJlc3BvbnNlID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzID0gSlNPTi5wYXJzZShyZXNwb25zZS5yZXNwb25zZVRleHQpIGFzIFJlczxhbnk+O1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHtyZXRjb2RlLCBtZXNzYWdlLCBkYXRhfSA9IHJlcztcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmV0Y29kZSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChtZXNzYWdlKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlLnJlc3BvbnNlVGV4dCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG9uZXJyb3I6IChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gbWFrZVBvc3RSZXF1ZXN0KHVpZDogc3RyaW5nLCByZWdpb246IHN0cmluZykge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICBHTV94bWxodHRwUmVxdWVzdCh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgIHVybDogQ0hBUkFDVEVSU19VUkwsXHJcbiAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgICAgICAgIFwiZWxlbWVudF9hdHRyX2lkc1wiOiBbXSxcclxuICAgICAgICAgICAgICAgIFwid2VhcG9uX2NhdF9pZHNcIjogW10sXHJcbiAgICAgICAgICAgICAgICBcInBhZ2VcIjogMSxcclxuICAgICAgICAgICAgICAgIFwic2l6ZVwiOiA1MCxcclxuICAgICAgICAgICAgICAgIFwidWlkXCI6IHVpZCxcclxuICAgICAgICAgICAgICAgIFwicmVnaW9uXCI6IHJlZ2lvblxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgb25sb2FkOiByZXNwb25zZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IEpTT04ucGFyc2UocmVzcG9uc2UucmVzcG9uc2VUZXh0KSBhcyBSZXM8Q2hhcmFjdGVyPjtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB7cmV0Y29kZSwgbWVzc2FnZSwgZGF0YX0gPSByZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJldGNvZGUgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QobWVzc2FnZSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZS5yZXNwb25zZVRleHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBvbmVycm9yOiAoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmNvbnN0IGdldEFjY291bnQgPSBhc3luYyAoKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHtsaXN0OiBhY2NvdW50TGlzdH0gPSBhd2FpdCBtYWtlR2V0UmVxdWVzdChST0xFX1VSTCkgYXMgRGF0YTxSb2xlPjtcclxuICAgICAgICByZXR1cm4gYWNjb3VudExpc3Q7XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycilcclxuICAgICAgICBhbGVydChcIuivt+ehruiupOW3sueZu+W9leexs+WTiOa4uOiuuuWdm+S4lOe7keWumuWOn+elnui0puaItyFcIilcclxuICAgICAgICBHTV9vcGVuSW5UYWIoQkJTX1VSTClcclxuICAgICAgICByZXR1cm4gW11cclxuICAgIH1cclxufTtcclxuXHJcbmNvbnN0IGdldENoYXJhY3RlcnMgPSBhc3luYyAodWlkOiBzdHJpbmcsIHJlZ2lvbjogc3RyaW5nKSA9PiB7XHJcbiAgICBjb25zdCB7bGlzdDogY2hhcmFjdGVyTGlzdH0gPSBhd2FpdCBtYWtlUG9zdFJlcXVlc3QodWlkLCByZWdpb24pIGFzIERhdGE8Q2hhcmFjdGVyPjtcclxuICAgIHJldHVybiBjaGFyYWN0ZXJMaXN0O1xyXG59O1xyXG5cclxuY29uc3QgZ2V0Q2hhcmFjdGVyRGV0YWlsID0gYXN5bmMgKGNoYXJhY3RlcjogQ2hhcmFjdGVyLCB1aWQ6IHN0cmluZywgcmVnaW9uOiBzdHJpbmcpID0+IHtcclxuICAgIGNvbnN0IHtpZH0gPSBjaGFyYWN0ZXI7XHJcbiAgICBjb25zdCBwYXJhbXMgPSBgP2F2YXRhcl9pZD0ke2lkfSZ1aWQ9JHt1aWR9JnJlZ2lvbj0ke3JlZ2lvbn1gXHJcbiAgICBsZXQgY2hhcmFjdGVyRGF0YSA9IGF3YWl0IG1ha2VHZXRSZXF1ZXN0KENIQVJBQ1RFUlNfREVUQUlMX1VSTCArIHBhcmFtcykgYXMgQ2hhcmFjdGVyRGF0YTtcclxuICAgIHJldHVybiB7Y2hhcmFjdGVyLCAuLi5jaGFyYWN0ZXJEYXRhfSBhcyBDaGFyYWN0ZXJEYXRhRXg7XHJcbn07XHJcblxyXG5jb25zdCBnZXREZXRhaWxMaXN0ID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgaWYgKCFnYW1lX3VpZCB8fCAhcmVnaW9uKSB7XHJcbiAgICAgICAgY29uc3QgYWNjb3VudExpc3Q6IG1vaG95by5Sb2xlW10gPSBhd2FpdCBnZXRBY2NvdW50KCk7XHJcbiAgICAgICAgaWYgKGFjY291bnRMaXN0Lmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCLotKbmiLfnu5Hlrprop5LoibLkv6Hmga/ojrflj5blpLHotKUhXCIpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhY2NvdW50SWR4ID49IGFjY291bnRMaXN0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICBhY2NvdW50SWR4ID0gYWNjb3VudExpc3QubGVuZ3RoIC0gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3Qge2dhbWVfdWlkOiBhVWlkLCByZWdpb246IGFSZWdpb259ID0gYWNjb3VudExpc3RbYWNjb3VudElkeF07XHJcbiAgICAgICAgZ2FtZV91aWQgPSBhVWlkO1xyXG4gICAgICAgIHJlZ2lvbiA9IGFSZWdpb24gPT0gXCJjbl9nZjAxXCIgPyBcImNuX2dmMDFcIiA6IFwiY25fcWQwMVwiO1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwibWlob3lvQWNjb3VudFwiLCBKU09OLnN0cmluZ2lmeSh7Z2FtZV91aWQsIHJlZ2lvbiwgYWNjb3VudElkeH0pKVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNoYXJhY3RlcnMgPSBhd2FpdCBnZXRDaGFyYWN0ZXJzKGdhbWVfdWlkLCByZWdpb24pO1xyXG4gICAgY29uc3QgZGV0YWlscyA9IGNoYXJhY3RlcnMubWFwKGMgPT4gZ2V0Q2hhcmFjdGVyRGV0YWlsKGMsIGdhbWVfdWlkLCByZWdpb24pKTtcclxuICAgIGNvbnN0IGRldGFpbExpc3QgPSBbXTtcclxuICAgIGZvciBhd2FpdCAobGV0IGQgb2YgZGV0YWlscykge1xyXG4gICAgICAgIGRldGFpbExpc3QucHVzaChkKTtcclxuICAgIH1cclxuICAgIHJldHVybiBkZXRhaWxMaXN0O1xyXG59XHJcblxyXG5cclxuZ2V0RGV0YWlsTGlzdCgpLnRoZW4oXHJcbiAgICByZXMgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHJlcyk7XHJcbiAgICAgICAgcmVzLmZvckVhY2goXHJcbiAgICAgICAgICAgIHYgPT4ge1xyXG4gICAgICAgICAgICAgICAgYWRkQ2hhcmFjdGVyKHYpXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApXHJcbiAgICB9XHJcbilcclxuIl0sInNvdXJjZVJvb3QiOiIifQ==