// ==UserScript==
// @name               genshinSeelieEx
// @name:zh            原神规划助手扩展
// @description        description
// @description:zh     个人想偷懒,不想手动在仙灵 - 原神规划助手 手动录入角色及其天赋,于是简单整理一个脚本,利用米游社养成计算器api获取角色信息,直接导入至seelie
// @include            https://seelie.inmagi.com/*
// @require            https://cdn.jsdelivr.net/npm/core-js-bundle@3.9.1/index.js
// @grant              unsafeWindow
// @grant              GM_setValue
// @grant              GM_download
// @grant              GM_xmlhttpRequest
// @grant              GM_openInTab
// @grant              GM_getResourceText
// @resource           character    https://cdn.jsdelivr.net/gh/KeyPJ/seelieEx@main/src/data/character.json
// @resource           weapon    https://cdn.jsdelivr.net/gh/KeyPJ/seelieEx@main/src/data/character.json
// @author             KeyPJ
// @namespace          https://github.com/KeyPJ/seelieEx
// @icon               https://seelie.inmagi.com/img/icons/favicon-32x32.png
// @version            1.0.6
// @connect            api-takumi.mihoyo.com
// @run-at             document-end
// @homepage           https://github.com/KeyPJ
// @homepageURL        https://github.com/KeyPJ/seelieEx
// @copyright          2021, KeyPJ https://github.com/KeyPJ
// @license            MIT
// @contributionURL    https://github.com/KeyPJ/seelieEx
// ==/UserScript==

(()=>{"use strict";const e=JSON.parse(GM_getResourceText("character")),t=JSON.parse(GM_getResourceText("weapon")),n=[{element_attr_id:1,name:"pyro"},{element_attr_id:2,name:"anemo"},{element_attr_id:3,name:"geo"},{element_attr_id:4,name:"electro"},{element_attr_id:5,name:"hydro"},{element_attr_id:6,name:"cryo"},{element_attr_id:7,name:"dendro"}],r=()=>vue.goals,o=(e,t,n,o)=>{let a=r();const l=a.map((e=>e.id)),i=Math.max(...l)+1||1,s=a.findIndex("character"==o?e=>e.type==o&&e.character==t:e=>e.type==o&&e.weapon==t),u=c(e,n);let d;if(s<0)d="character"==o?{type:o,character:t,current:u,goal:u,id:i}:{type:o,character:"",weapon:t,current:u,goal:u,id:i};else{const e=a[s],{goal:t,current:n}=e,{level:r,asc:o}=n,{level:c,asc:l}=t,{level:i,asc:m}=u;d=Object.assign(Object.assign({},e),{current:i>=r&&m>=o?u:n,goal:i>=c&&m>=l?u:t})}vue.addGoal(d)};const a=[{level:1,asc:0,text:"1"},{level:20,asc:0,text:"20"},{level:40,asc:1,text:"40"},{level:50,asc:2,text:"50"},{level:60,asc:3,text:"60"},{level:70,asc:4,text:"70"},{level:80,asc:5,text:"80"},{level:90,asc:6,text:"90"}],c=(e,t)=>{let n=a[0];if(e<20)return n;for(let r of a){const{level:o}=r;if(e<o){const{asc:e,text:t}=n;return Object.assign(Object.assign({},n),{asc:e+1,text:`${t} A`})}if(e==o)return 90!=e&&console.log(`米游社数据无法判断是否突破,请自行比较${t}是否已突破`),r;e>=o&&(n=r)}return n};var l=function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function c(e){try{i(r.next(e))}catch(e){a(e)}}function l(e){try{i(r.throw(e))}catch(e){a(e)}}function i(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,l)}i((r=r.apply(e,t||[])).next())}))};const i=localStorage.getItem("mihoyoAccount");let s;i&&(s=JSON.parse(i));let{game_uid:u,region:d,accountIdx:m}=s||{game_uid:"",region:"cn_qd01",accountIdx:0};function g(e){return new Promise(((t,n)=>{GM_xmlhttpRequest({method:"GET",url:e,onload:e=>{if(200==e.status){const r=JSON.parse(e.responseText),{retcode:o,message:a,data:c}=r;0===o?t(c):n(a)}else n(e.responseText)},onerror:e=>{n(e)}})}))}console.log("mihoyoAccount"),console.log({game_uid:u,region:d,accountIdx:m});l(void 0,void 0,void 0,(function*(){var e,t;if(!u||!d){const e=yield l(void 0,void 0,void 0,(function*(){try{const{list:e}=yield g("https://api-takumi.mihoyo.com/binding/api/getUserGameRolesByCookie?game_biz=hk4e_cn");return e}catch(e){return console.error(e),alert("请确认已登录米哈游论坛且绑定原神账户!"),GM_openInTab("https://bbs.mihoyo.com/ys/"),[]}}));if(0===e.length)throw new Error("账户绑定角色信息获取失败!");m>=e.length&&(m=e.length-1);const{game_uid:t,region:n}=e[m];u=t,d="cn_gf01"==n?"cn_gf01":"cn_qd01",localStorage.setItem("mihoyoAccount",JSON.stringify({game_uid:u,region:d,accountIdx:m}))}const n=(yield((e,t)=>l(void 0,void 0,void 0,(function*(){const{list:n}=yield function(e,t){return new Promise(((n,r)=>{GM_xmlhttpRequest({method:"POST",url:"https://api-takumi.mihoyo.com/event/e20200928calculate/v1/sync/avatar/list",data:JSON.stringify({element_attr_ids:[],weapon_cat_ids:[],page:1,size:50,uid:e,region:t}),onload:e=>{if(200==e.status){const t=JSON.parse(e.responseText),{retcode:o,message:a,data:c}=t;0===o?n(c):r(a)}else r(e.responseText)},onerror:e=>{r(e)}})}))}(e,t);return n})))(u,d)).map((e=>((e,t,n)=>l(void 0,void 0,void 0,(function*(){const{id:r}=e,o=`?avatar_id=${r}&uid=${t}&region=${n}`;let a=yield g("https://api-takumi.mihoyo.com/event/e20200928calculate/v1/sync/avatar/detail"+o);return Object.assign({character:e},a)})))(e,u,d))),r=[];try{for(var o,a=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,o){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,o,(t=e[n](t)).done,t.value)}))}}}(n);!(o=yield a.next()).done;){let e=o.value;r.push(e)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=a.return)&&(yield t.call(a))}finally{if(e)throw e.error}}return r})).then((a=>{console.log(a),a.forEach((a=>{!function(a){const{character:c,skill_list:l,weapon:i}=a,{name:s,element_attr_id:u}=c;if(i){const{name:e,level_current:n}=i,r=(e=>{for(let n of t){const{id:t,name:r}=n;if(e==r)return t}return console.error(`getWeaponrId ${e} 查询失败`),""})(e);console.log(r,e),r&&o(n,r,e,"weapon")}const{level_current:d}=c,m=(t=>{for(let n of e){const{id:e,name:r}=n;if(t==r)return e}return console.error(`getCharacterId ${t} 查询失败`),""})(s);if(!m)return;o(d,m,s,"character");let g=m;"traveler"==m&&(g=`traveler_${(e=>{for(let t of n){const{element_attr_id:n,name:r}=t;if(e==n)return r}return console.error(`getElementAttrName: ${e} 查询失败`),""})(u)}`),((e,t)=>{const n=r(),o=n.map((e=>e.id)),a=Math.max(...o)+1||1,c=n.findIndex((t=>"talent"==t.type&&t.character==e)),[l,i,s]=t.filter((e=>10==e.max_level)).sort().map((e=>e.level_current));let u;if(console.log(e,[l,i,s]),c<0)u={type:"talent",character:e,c3:!1,c5:!1,normal:{current:l,goal:l},skill:{current:i,goal:i},burst:{current:s,goal:s},id:a};else{const e=n[c],{normal:t,skill:r,burst:o}=e,{goal:a}=t,{goal:d}=r,{goal:m}=o;u=Object.assign(Object.assign({},e),{normal:{current:l,goal:l>a?l:a},skill:{current:i,goal:i>d?i:d},burst:{current:s,goal:s>m?s:m}})}vue.addGoal(u)})(g,l)}(a)}))}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90YW1wZXJtb25rZXktd2VicGFjay10ZW1wbGF0ZS8uL3NyYy9jb25maWcudHMiLCJ3ZWJwYWNrOi8vdGFtcGVybW9ua2V5LXdlYnBhY2stdGVtcGxhdGUvLi9zcmMvcXVlcnkudHMiLCJ3ZWJwYWNrOi8vdGFtcGVybW9ua2V5LXdlYnBhY2stdGVtcGxhdGUvLi9zcmMvc2VlbGllLnRzIiwid2VicGFjazovL3RhbXBlcm1vbmtleS13ZWJwYWNrLXRlbXBsYXRlLy4vc3JjL2luZGV4LnRzIl0sIm5hbWVzIjpbImNoYXJhY3RlcnMiLCJKU09OIiwicGFyc2UiLCJHTV9nZXRSZXNvdXJjZVRleHQiLCJ3ZWFwb25zIiwiZWxlbWVudEF0dHJJZHMiLCJlbGVtZW50X2F0dHJfaWQiLCJuYW1lIiwiZ2V0VG90YWxHb2FsIiwidnVlIiwiZ29hbHMiLCJhZGRDaGFyYWN0ZXJHb2FsIiwibGV2ZWxfY3VycmVudCIsIm5hbWVFbiIsInR5cGUiLCJ0b3RhbEdvYWwiLCJpZHMiLCJtYXAiLCJnIiwiaWQiLCJNYXRoIiwibWF4IiwiY2hhcmFjdGVySWR4IiwiZmluZEluZGV4IiwiY2hhcmFjdGVyIiwid2VhcG9uIiwiY2hhcmFjdGVyU3RhdHVzIiwiaW5pdENoYXJhY3RlclN0YXR1cyIsImNoYXJhY3RlckdvYWwiLCJjdXJyZW50IiwiZ29hbCIsInNlZWxpZUdvYWwiLCJsZXZlbCIsImxldmVsQ3VycmVudCIsImFzYyIsImFzY0N1cnJlbnQiLCJsZXZlbEdvYWwiLCJhc2NHb2FsIiwiYWRkR29hbCIsImNoYXJhY3RlclN0YXR1c0xpc3QiLCJ0ZXh0IiwiY29uc29sZSIsImxvZyIsIm1paG95b0FjY291bnRTdHIiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwibWlob3lvQWNjb3VudCIsImdhbWVfdWlkIiwicmVnaW9uIiwiYWNjb3VudElkeCIsIm1ha2VHZXRSZXF1ZXN0IiwidXJsIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJHTV94bWxodHRwUmVxdWVzdCIsIm1ldGhvZCIsIm9ubG9hZCIsInJlc3BvbnNlIiwic3RhdHVzIiwicmVzIiwicmVzcG9uc2VUZXh0IiwicmV0Y29kZSIsIm1lc3NhZ2UiLCJkYXRhIiwib25lcnJvciIsImVycm9yIiwiYWNjb3VudExpc3QiLCJsaXN0IiwiZXJyIiwiYWxlcnQiLCJHTV9vcGVuSW5UYWIiLCJsZW5ndGgiLCJFcnJvciIsImFVaWQiLCJhUmVnaW9uIiwic2V0SXRlbSIsInN0cmluZ2lmeSIsImRldGFpbHMiLCJ1aWQiLCJjaGFyYWN0ZXJMaXN0IiwibWFrZVBvc3RSZXF1ZXN0IiwiZ2V0Q2hhcmFjdGVycyIsImMiLCJwYXJhbXMiLCJjaGFyYWN0ZXJEYXRhIiwiZ2V0Q2hhcmFjdGVyRGV0YWlsIiwiZGV0YWlsTGlzdCIsImQiLCJwdXNoIiwidGhlbiIsImZvckVhY2giLCJ2IiwiY2hhcmFjdGVyRGF0YUV4Iiwic2tpbGxfbGlzdCIsIndlYXBvbkxldmVMIiwid2VhcG9uSWQiLCJxdWVyeU5hbWUiLCJlIiwiZ2V0V2VhcG9uSWQiLCJjaGFyYWN0ZXJMZXZlbCIsImNoYXJhY3RlcklkIiwiZ2V0Q2hhcmFjdGVySWQiLCJ0YWxlbnRDaGFyYWN0ZXIiLCJnZXRFbGVtZW50QXR0ck5hbWUiLCJ0YWxlbnRJZHgiLCJub3JtYWxDdXJyZW50Iiwic2tpbGxDdXJyZW50IiwiYnVyc3RDdXJyZW50IiwiZmlsdGVyIiwiYSIsIm1heF9sZXZlbCIsInNvcnQiLCJ0YWxlbnRHb2FsIiwiYzMiLCJjNSIsIm5vcm1hbCIsInNraWxsIiwiYnVyc3QiLCJub3JtYWxHb2FsIiwic2tpbGxHb2FsIiwiYnVyc3RHb2FsIiwiYWRkVGFsZW50R29hbCIsImFkZENoYXJhY3RlciJdLCJtYXBwaW5ncyI6Im1CQUVPLE1DR0RBLEVBQWFDLEtBQUtDLE1BQU1DLG1CQUFtQixjQUMzQ0MsRUFBVUgsS0FBS0MsTUFBTUMsbUJBQW1CLFdBd0J4Q0UsRUFBaUIsQ0FDbkIsQ0FBQ0MsZ0JBQWlCLEVBQUdDLEtBQU0sUUFDM0IsQ0FBQ0QsZ0JB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QUVDLFlBQWlCQyxPQUFPL0YsS0FBSTZGLEdBQUtBLEVBQUVsRyxnQkFFaEgsSUFBSXFHLEVBQ0osR0FGQXhFLFFBQVFDLElBQUk2RCxFQUFpQixDQUFDRyxFQUFlQyxFQUFjQyxJQUV2REgsRUFBWSxFQUNaUSxFQUFhLENBQ1RuRyxLQUFNLFNBQ05VLFVBQVcrRSxFQUNYVyxJQUFJLEVBQ0pDLElBQUksRUFDSkMsT0FBUSxDQUNKdkYsUUFBUzZFLEVBQ1Q1RSxLQUFNNEUsR0FFVlcsTUFBTyxDQUNIeEYsUUFBUzhFLEVBQ1Q3RSxLQUFNNkUsR0FFVlcsTUFBTyxDQUNIekYsUUFBUytFLEVBQ1Q5RSxLQUFNOEUsR0FFVnpGLFVBRUQsQ0FDSCxNQUFNWSxFQUFhaEIsRUFBVTBGLElBQ3ZCLE9BQUNXLEVBQU0sTUFBRUMsRUFBSyxNQUFFQyxHQUFTdkYsR0FDeEJELEtBQU15RixHQUFjSCxHQUNwQnRGLEtBQU0wRixHQUFhSCxHQUNuQnZGLEtBQU0yRixHQUFhSCxFQUMxQkwsRUFBYSxPQUFILHdCQUNIbEYsR0FBVSxDQUNicUYsT0FBUSxDQUNKdkYsUUFBUzZFLEVBQ1Q1RSxLQUFNNEUsRUFBZ0JhLEVBQWFiLEVBQWdCYSxHQUNwREYsTUFBTyxDQUNOeEYsUUFBUzhFLEVBQ1Q3RSxLQUFNNkUsRUFBZWEsRUFBWWIsRUFBZWEsR0FDakRGLE1BQU8sQ0FDTnpGLFFBQVMrRSxFQUNUOUUsS0FBTThFLEVBQWVhLEVBQVliLEVBQWVhLEtBSzVEaEgsSUFBSTZCLFFBQVEyRSxJQW1GWlMsQ0FBY25CLEVBQWlCVCxHQ1huQjZCLENBQWEvQixVIiwiZmlsZSI6ImluZGV4LnVzZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbmZpZ30gZnJvbSBcIi4vQHR5cGVcIjtcclxuXHJcbmV4cG9ydCBjb25zdCBjb25maWcgPSB7XHJcbiAgICBnYW1lX3VpZDogXCJcIiwvLzUwMTcyNTE3MlxyXG4gICAgcmVnaW9uOiBcImNuX3FkMDFcIiwvL1xyXG4gICAgYWNjb3VudElkeDogMFxyXG59IGFzIENvbmZpZztcclxuIiwiaW50ZXJmYWNlIHF1ZXJ5TmFtZSB7XHJcbiAgICBpZDogc3RyaW5nLFxyXG4gICAgbmFtZTogc3RyaW5nXHJcbn1cclxuXHJcbmNvbnN0IGNoYXJhY3RlcnMgPSBKU09OLnBhcnNlKEdNX2dldFJlc291cmNlVGV4dChcImNoYXJhY3RlclwiKSkgYXMgcXVlcnlOYW1lW107XHJcbmNvbnN0IHdlYXBvbnMgPSBKU09OLnBhcnNlKEdNX2dldFJlc291cmNlVGV4dChcIndlYXBvblwiKSkgYXMgcXVlcnlOYW1lW107XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0Q2hhcmFjdGVySWQgPSAocXVlcnlOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgIGZvciAobGV0IGUgb2YgY2hhcmFjdGVycykge1xyXG4gICAgICAgIGNvbnN0IHtpZCwgbmFtZX0gPSBlXHJcbiAgICAgICAgaWYgKHF1ZXJ5TmFtZSA9PSBuYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zb2xlLmVycm9yKGBnZXRDaGFyYWN0ZXJJZCAke3F1ZXJ5TmFtZX0g5p+l6K+i5aSx6LSlYClcclxuICAgIHJldHVybiBcIlwiXHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgZ2V0V2VhcG9uSWQgPSAocXVlcnlOYW1lOiBzdHJpbmcpID0+IHtcclxuICAgIGZvciAobGV0IGUgb2Ygd2VhcG9ucykge1xyXG4gICAgICAgIGNvbnN0IHtpZCwgbmFtZX0gPSBlXHJcbiAgICAgICAgaWYgKHF1ZXJ5TmFtZSA9PSBuYW1lKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpZDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zb2xlLmVycm9yKGBnZXRXZWFwb25ySWQgJHtxdWVyeU5hbWV9IOafpeivouWksei0pWApXHJcbiAgICByZXR1cm4gXCJcIlxyXG59O1xyXG5cclxuY29uc3QgZWxlbWVudEF0dHJJZHMgPSBbXHJcbiAgICB7ZWxlbWVudF9hdHRyX2lkOiAxLCBuYW1lOiBcInB5cm9cIn0sXHJcbiAgICB7ZWxlbWVudF9hdHRyX2lkOiAyLCBuYW1lOiBcImFuZW1vXCJ9LFxyXG4gICAge2VsZW1lbnRfYXR0cl9pZDogMywgbmFtZTogXCJnZW9cIn0sXHJcbiAgICB7ZWxlbWVudF9hdHRyX2lkOiA0LCBuYW1lOiBcImVsZWN0cm9cIn0sXHJcbiAgICB7ZWxlbWVudF9hdHRyX2lkOiA1LCBuYW1lOiBcImh5ZHJvXCJ9LFxyXG4gICAge2VsZW1lbnRfYXR0cl9pZDogNiwgbmFtZTogXCJjcnlvXCJ9LFxyXG4gICAge2VsZW1lbnRfYXR0cl9pZDogNywgbmFtZTogXCJkZW5kcm9cIn0sXHJcbl1cclxuXHJcblxyXG5leHBvcnQgY29uc3QgZ2V0RWxlbWVudEF0dHJOYW1lID0gKHF1ZXJ5TmFtZTogbnVtYmVyKSA9PiB7XHJcblxyXG4gICAgZm9yIChsZXQgZSBvZiBlbGVtZW50QXR0cklkcykge1xyXG4gICAgICAgIGNvbnN0IHtlbGVtZW50X2F0dHJfaWQsIG5hbWV9ID0gZVxyXG4gICAgICAgIGlmIChxdWVyeU5hbWUgPT0gZWxlbWVudF9hdHRyX2lkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuYW1lO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbnNvbGUuZXJyb3IoYGdldEVsZW1lbnRBdHRyTmFtZTogJHtxdWVyeU5hbWV9IOafpeivouWksei0pWApXHJcbiAgICByZXR1cm4gXCJcIlxyXG59O1xyXG4iLCJpbXBvcnQgR29hbCA9IHNlZWxpZS5Hb2FsO1xyXG5pbXBvcnQge21vaG95b30gZnJvbSBcIi4vQHR5cGUvbW9ob3lvXCI7XHJcbmltcG9ydCBDaGFyYWN0ZXJEYXRhRXggPSBtb2hveW8uQ2hhcmFjdGVyRGF0YUV4O1xyXG5pbXBvcnQgQ2hhcmFjdGVyU3RhdHVzID0gc2VlbGllLkNoYXJhY3RlclN0YXR1cztcclxuaW1wb3J0IENoYXJhY3RlckdvYWwgPSBzZWVsaWUuQ2hhcmFjdGVyR29hbDtcclxuaW1wb3J0IFRhbGVudEdvYWwgPSBzZWVsaWUuVGFsZW50R29hbDtcclxuaW1wb3J0IHtnZXRDaGFyYWN0ZXJJZCwgZ2V0RWxlbWVudEF0dHJOYW1lLCBnZXRXZWFwb25JZH0gZnJvbSBcIi4vcXVlcnlcIjtcclxuaW1wb3J0IFdlYXBvbkdvYWwgPSBzZWVsaWUuV2VhcG9uR29hbDtcclxuXHJcblxyXG5leHBvcnQgY29uc3QgZ2V0VG90YWxHb2FsID0gKCkgPT4ge1xyXG4gICAgLy8gQHRzLWlnbm9yZVxyXG4gICAgY29uc3QgZ29hbHM6IEdvYWxbXSA9IHZ1ZS5nb2FscztcclxuICAgIHJldHVybiBnb2FscztcclxufTtcclxuXHJcbmNvbnN0IGFkZFRhbGVudEdvYWwgPSAodGFsZW50Q2hhcmFjdGVyOiBzdHJpbmcsIHNraWxsX2xpc3Q6IG1vaG95by5Ta2lsbFtdKSA9PiB7XHJcbiAgICBjb25zdCB0b3RhbEdvYWw6IEdvYWxbXSA9IGdldFRvdGFsR29hbCgpO1xyXG4gICAgY29uc3QgaWRzID0gdG90YWxHb2FsLm1hcChnID0+IGcuaWQpO1xyXG4gICAgY29uc3QgaWQgPSBNYXRoLm1heCguLi5pZHMpICsgMSB8fCAxO1xyXG4gICAgY29uc3QgdGFsZW50SWR4ID0gdG90YWxHb2FsLmZpbmRJbmRleChnID0+IGcudHlwZSA9PSBcInRhbGVudFwiICYmIGcuY2hhcmFjdGVyID09IHRhbGVudENoYXJhY3Rlcik7XHJcbiAgICBjb25zdCBbbm9ybWFsQ3VycmVudCwgc2tpbGxDdXJyZW50LCBidXJzdEN1cnJlbnRdID0gc2tpbGxfbGlzdC5maWx0ZXIoYSA9PiBhLm1heF9sZXZlbCA9PSAxMCkuc29ydCgpLm1hcChhID0+IGEubGV2ZWxfY3VycmVudClcclxuICAgIGNvbnNvbGUubG9nKHRhbGVudENoYXJhY3RlciwgW25vcm1hbEN1cnJlbnQsIHNraWxsQ3VycmVudCwgYnVyc3RDdXJyZW50XSlcclxuICAgIGxldCB0YWxlbnRHb2FsOiBUYWxlbnRHb2FsO1xyXG4gICAgaWYgKHRhbGVudElkeCA8IDApIHtcclxuICAgICAgICB0YWxlbnRHb2FsID0ge1xyXG4gICAgICAgICAgICB0eXBlOiBcInRhbGVudFwiLFxyXG4gICAgICAgICAgICBjaGFyYWN0ZXI6IHRhbGVudENoYXJhY3RlcixcclxuICAgICAgICAgICAgYzM6IGZhbHNlLFxyXG4gICAgICAgICAgICBjNTogZmFsc2UsXHJcbiAgICAgICAgICAgIG5vcm1hbDoge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudDogbm9ybWFsQ3VycmVudCxcclxuICAgICAgICAgICAgICAgIGdvYWw6IG5vcm1hbEN1cnJlbnRcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc2tpbGw6IHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQ6IHNraWxsQ3VycmVudCxcclxuICAgICAgICAgICAgICAgIGdvYWw6IHNraWxsQ3VycmVudFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBidXJzdDoge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudDogYnVyc3RDdXJyZW50LFxyXG4gICAgICAgICAgICAgICAgZ29hbDogYnVyc3RDdXJyZW50XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGlkXHJcbiAgICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBzZWVsaWVHb2FsID0gdG90YWxHb2FsW3RhbGVudElkeF0gYXMgVGFsZW50R29hbDtcclxuICAgICAgICBjb25zdCB7bm9ybWFsLCBza2lsbCwgYnVyc3R9ID0gc2VlbGllR29hbDtcclxuICAgICAgICBjb25zdCB7Z29hbDogbm9ybWFsR29hbH0gPSBub3JtYWw7XHJcbiAgICAgICAgY29uc3Qge2dvYWw6IHNraWxsR29hbH0gPSBza2lsbDtcclxuICAgICAgICBjb25zdCB7Z29hbDogYnVyc3RHb2FsfSA9IGJ1cnN0O1xyXG4gICAgICAgIHRhbGVudEdvYWwgPSB7XHJcbiAgICAgICAgICAgIC4uLnNlZWxpZUdvYWwsXHJcbiAgICAgICAgICAgIG5vcm1hbDoge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudDogbm9ybWFsQ3VycmVudCxcclxuICAgICAgICAgICAgICAgIGdvYWw6IG5vcm1hbEN1cnJlbnQgPiBub3JtYWxHb2FsID8gbm9ybWFsQ3VycmVudCA6IG5vcm1hbEdvYWxcclxuICAgICAgICAgICAgfSwgc2tpbGw6IHtcclxuICAgICAgICAgICAgICAgIGN1cnJlbnQ6IHNraWxsQ3VycmVudCxcclxuICAgICAgICAgICAgICAgIGdvYWw6IHNraWxsQ3VycmVudCA+IHNraWxsR29hbCA/IHNraWxsQ3VycmVudCA6IHNraWxsR29hbFxyXG4gICAgICAgICAgICB9LCBidXJzdDoge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudDogYnVyc3RDdXJyZW50LFxyXG4gICAgICAgICAgICAgICAgZ29hbDogYnVyc3RDdXJyZW50ID4gYnVyc3RHb2FsID8gYnVyc3RDdXJyZW50IDogYnVyc3RHb2FsXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBAdHMtaWdub3JlXHJcbiAgICB2dWUuYWRkR29hbCh0YWxlbnRHb2FsKVxyXG59O1xyXG5cclxuZXhwb3J0IGNvbnN0IGFkZENoYXJhY3RlckdvYWwgPSAobGV2ZWxfY3VycmVudDogbnVtYmVyLCBuYW1lRW46IFN0cmluZywgbmFtZTogc3RyaW5nLCB0eXBlOiBzdHJpbmcpID0+IHtcclxuICAgIGxldCB0b3RhbEdvYWw6IEdvYWxbXSA9IGdldFRvdGFsR29hbCgpO1xyXG4gICAgY29uc3QgaWRzID0gdG90YWxHb2FsLm1hcChnID0+IGcuaWQpO1xyXG4gICAgY29uc3QgaWQgPSBNYXRoLm1heCguLi5pZHMpICsgMSB8fCAxO1xyXG4gICAgbGV0IGNoYXJhY3RlclByZWRpY2F0ZSA9IChnOiBHb2FsKSA9PiBnLnR5cGUgPT0gdHlwZSAmJiBnLmNoYXJhY3RlciA9PSBuYW1lRW47XHJcbiAgICBsZXQgd2VhcG9uUHJlZGljYXRlID0gKGc6IEdvYWwpID0+IGcudHlwZSA9PSB0eXBlICYmIGcud2VhcG9uID09IG5hbWVFbjtcclxuICAgIGNvbnN0IGNoYXJhY3RlcklkeCA9IHRvdGFsR29hbC5maW5kSW5kZXgodHlwZSA9PSBcImNoYXJhY3RlclwiID8gY2hhcmFjdGVyUHJlZGljYXRlIDogd2VhcG9uUHJlZGljYXRlKTtcclxuICAgIGNvbnN0IGNoYXJhY3RlclN0YXR1czogQ2hhcmFjdGVyU3RhdHVzID0gaW5pdENoYXJhY3RlclN0YXR1cyhsZXZlbF9jdXJyZW50LCBuYW1lKTtcclxuXHJcbiAgICBsZXQgY2hhcmFjdGVyR29hbDogR29hbFxyXG5cclxuICAgIGZ1bmN0aW9uIGluaXRDaGFyYWN0ZXJHb2FsKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHR5cGUsXHJcbiAgICAgICAgICAgIGNoYXJhY3RlcjogbmFtZUVuLFxyXG4gICAgICAgICAgICBjdXJyZW50OiBjaGFyYWN0ZXJTdGF0dXMsXHJcbiAgICAgICAgICAgIGdvYWw6IGNoYXJhY3RlclN0YXR1cyxcclxuICAgICAgICAgICAgaWRcclxuICAgICAgICB9IGFzIENoYXJhY3RlckdvYWxcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBpbml0V2VhcG9uR29hbCgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICB0eXBlLFxyXG4gICAgICAgICAgICBjaGFyYWN0ZXI6IFwiXCIsXHJcbiAgICAgICAgICAgIHdlYXBvbjogbmFtZUVuLFxyXG4gICAgICAgICAgICBjdXJyZW50OiBjaGFyYWN0ZXJTdGF0dXMsXHJcbiAgICAgICAgICAgIGdvYWw6IGNoYXJhY3RlclN0YXR1cyxcclxuICAgICAgICAgICAgaWRcclxuICAgICAgICB9IGFzIFdlYXBvbkdvYWxcclxuICAgIH1cclxuXHJcbiAgICBpZiAoY2hhcmFjdGVySWR4IDwgMCkge1xyXG4gICAgICAgIGNoYXJhY3RlckdvYWwgPSB0eXBlID09IFwiY2hhcmFjdGVyXCIgPyBpbml0Q2hhcmFjdGVyR29hbCgpIDogaW5pdFdlYXBvbkdvYWwoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3Qgc2VlbGllR29hbCA9IHR5cGUgPT0gXCJjaGFyYWN0ZXJcIiA/IHRvdGFsR29hbFtjaGFyYWN0ZXJJZHhdIGFzIENoYXJhY3RlckdvYWwgOiB0b3RhbEdvYWxbY2hhcmFjdGVySWR4XSBhcyBXZWFwb25Hb2FsXHJcbiAgICAgICAgY29uc3Qge2dvYWwsIGN1cnJlbnR9ID0gc2VlbGllR29hbDtcclxuICAgICAgICBjb25zdCB7bGV2ZWw6IGxldmVsQ3VycmVudCwgYXNjOiBhc2NDdXJyZW50fSA9IGN1cnJlbnQ7XHJcbiAgICAgICAgY29uc3Qge2xldmVsOiBsZXZlbEdvYWwsIGFzYzogYXNjR29hbH0gPSBnb2FsO1xyXG4gICAgICAgIGNvbnN0IHtsZXZlbCwgYXNjfSA9IGNoYXJhY3RlclN0YXR1cztcclxuXHJcbiAgICAgICAgY2hhcmFjdGVyR29hbCA9IHtcclxuICAgICAgICAgICAgLi4uc2VlbGllR29hbCxcclxuICAgICAgICAgICAgY3VycmVudDogbGV2ZWwgPj0gbGV2ZWxDdXJyZW50ICYmIGFzYyA+PSBhc2NDdXJyZW50ID8gY2hhcmFjdGVyU3RhdHVzIDogY3VycmVudCxcclxuICAgICAgICAgICAgZ29hbDogbGV2ZWwgPj0gbGV2ZWxHb2FsICYmIGFzYyA+PSBhc2NHb2FsID8gY2hhcmFjdGVyU3RhdHVzIDogZ29hbCxcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvLyBAdHMtaWdub3JlXHJcbiAgICB0eXBlID09IFwiY2hhcmFjdGVyXCIgPyB2dWUuYWRkR29hbChjaGFyYWN0ZXJHb2FsIGFzIENoYXJhY3RlckdvYWwpIDogdnVlLmFkZEdvYWwoY2hhcmFjdGVyR29hbCBhcyBXZWFwb25Hb2FsKVxyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGFkZENoYXJhY3RlcihjaGFyYWN0ZXJEYXRhRXg6IENoYXJhY3RlckRhdGFFeCkge1xyXG5cclxuICAgIGNvbnN0IHtjaGFyYWN0ZXIsIHNraWxsX2xpc3QsIHdlYXBvbn0gPSBjaGFyYWN0ZXJEYXRhRXg7XHJcbiAgICBjb25zdCB7bmFtZSwgZWxlbWVudF9hdHRyX2lkfSA9IGNoYXJhY3RlcjtcclxuXHJcbiAgICAvL3tcInR5cGVcIjpcImNoYXJhY3RlclwiLFwiY2hhcmFjdGVyXCI6XCJ0cmF2ZWxlclwiLFwiY3VycmVudFwiOntcImxldmVsXCI6NzAsXCJhc2NcIjo0LFwidGV4dFwiOlwiNzBcIn0sXCJnb2FsXCI6e1wibGV2ZWxcIjo3MCxcImFzY1wiOjQsXCJ0ZXh0XCI6XCI3MFwifSxcImlkXCI6MX0sXHJcbiAgICAvL3tcInR5cGVcIjpcIndlYXBvblwiLFwid2VhcG9uXCI6XCJcImRlYXRobWF0Y2hcIlwiLFwiY3VycmVudFwiOntcImxldmVsXCI6NzAsXCJhc2NcIjo0LFwidGV4dFwiOlwiNzBcIn0sXCJnb2FsXCI6e1wibGV2ZWxcIjo3MCxcImFzY1wiOjQsXCJ0ZXh0XCI6XCI3MFwifSxcImlkXCI6MX0sXHJcbiAgICAvL3tcInR5cGVcIjpcInRhbGVudFwiLFwiY2hhcmFjdGVyXCI6XCJ0cmF2ZWxlcl9nZW9cIixcImMzXCI6ZmFsc2UsXCJjNVwiOmZhbHNlLFwibm9ybWFsXCI6e1wiY3VycmVudFwiOjEsXCJnb2FsXCI6Nn0sXCJza2lsbFwiOntcImN1cnJlbnRcIjoxLFwiZ29hbFwiOjZ9LFwiYnVyc3RcIjp7XCJjdXJyZW50XCI6MSxcImdvYWxcIjo2fSxcImlkXCI6Mn1cclxuXHJcbiAgICBpZiAod2VhcG9uKSB7XHJcbiAgICAgICAgY29uc3Qge25hbWUsIGxldmVsX2N1cnJlbnQ6IHdlYXBvbkxldmVMfSA9IHdlYXBvbjtcclxuICAgICAgICBjb25zdCB3ZWFwb25JZCA9IGdldFdlYXBvbklkKG5hbWUpO1xyXG4gICAgICAgIGNvbnNvbGUubG9nKHdlYXBvbklkLCBuYW1lKTtcclxuICAgICAgICBpZiAod2VhcG9uSWQpIHtcclxuICAgICAgICAgICAgYWRkQ2hhcmFjdGVyR29hbCh3ZWFwb25MZXZlTCwgd2VhcG9uSWQsIG5hbWUsIFwid2VhcG9uXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbnN0IHtsZXZlbF9jdXJyZW50OiBjaGFyYWN0ZXJMZXZlbH0gPSBjaGFyYWN0ZXI7XHJcbiAgICBjb25zdCBjaGFyYWN0ZXJJZCA9IGdldENoYXJhY3RlcklkKG5hbWUpO1xyXG4gICAgaWYgKCFjaGFyYWN0ZXJJZCkge1xyXG4gICAgICAgIHJldHVyblxyXG4gICAgfVxyXG4gICAgYWRkQ2hhcmFjdGVyR29hbChjaGFyYWN0ZXJMZXZlbCwgY2hhcmFjdGVySWQsIG5hbWUsIFwiY2hhcmFjdGVyXCIpO1xyXG5cclxuICAgIGxldCB0YWxlbnRDaGFyYWN0ZXIgPSBjaGFyYWN0ZXJJZDtcclxuICAgIGlmIChjaGFyYWN0ZXJJZCA9PSBcInRyYXZlbGVyXCIpIHtcclxuICAgICAgICBjb25zdCBlbGVtZW50QXR0ck5hbWUgPSBnZXRFbGVtZW50QXR0ck5hbWUoZWxlbWVudF9hdHRyX2lkKTtcclxuICAgICAgICB0YWxlbnRDaGFyYWN0ZXIgPSBgdHJhdmVsZXJfJHtlbGVtZW50QXR0ck5hbWV9YDtcclxuICAgIH1cclxuICAgIGFkZFRhbGVudEdvYWwodGFsZW50Q2hhcmFjdGVyLCBza2lsbF9saXN0KTtcclxuXHJcbn1cclxuXHJcbmNvbnN0IGNoYXJhY3RlclN0YXR1c0xpc3Q6IENoYXJhY3RlclN0YXR1c1tdID0gW1xyXG4gICAge2xldmVsOiAxLCBhc2M6IDAsIHRleHQ6IFwiMVwifSxcclxuICAgIHtsZXZlbDogMjAsIGFzYzogMCwgdGV4dDogXCIyMFwifSxcclxuICAgIHtsZXZlbDogNDAsIGFzYzogMSwgdGV4dDogXCI0MFwifSxcclxuICAgIHtsZXZlbDogNTAsIGFzYzogMiwgdGV4dDogXCI1MFwifSxcclxuICAgIHtsZXZlbDogNjAsIGFzYzogMywgdGV4dDogXCI2MFwifSxcclxuICAgIHtsZXZlbDogNzAsIGFzYzogNCwgdGV4dDogXCI3MFwifSxcclxuICAgIHtsZXZlbDogODAsIGFzYzogNSwgdGV4dDogXCI4MFwifSxcclxuICAgIHtsZXZlbDogOTAsIGFzYzogNiwgdGV4dDogXCI5MFwifSxcclxuXVxyXG5cclxuY29uc3QgaW5pdENoYXJhY3RlclN0YXR1cyA9IChsZXZlbF9jdXJyZW50OiBudW1iZXIsIG5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgbGV0IGluaXRDaGFyYWN0ZXJTdGF0dXMgPSBjaGFyYWN0ZXJTdGF0dXNMaXN0WzBdO1xyXG4gICAgaWYgKGxldmVsX2N1cnJlbnQgPCAyMCkge1xyXG4gICAgICAgIHJldHVybiBpbml0Q2hhcmFjdGVyU3RhdHVzO1xyXG4gICAgfVxyXG4gICAgZm9yIChsZXQgY2hhcmFjdGVyU3RhdHVzIG9mIGNoYXJhY3RlclN0YXR1c0xpc3QpIHtcclxuICAgICAgICBjb25zdCB7bGV2ZWx9ID0gY2hhcmFjdGVyU3RhdHVzO1xyXG4gICAgICAgIGlmIChsZXZlbF9jdXJyZW50IDwgbGV2ZWwpIHtcclxuICAgICAgICAgICAgY29uc3Qge2FzYywgdGV4dH0gPSBpbml0Q2hhcmFjdGVyU3RhdHVzXHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAuLi5pbml0Q2hhcmFjdGVyU3RhdHVzLFxyXG4gICAgICAgICAgICAgICAgYXNjOiBhc2MgKyAxLFxyXG4gICAgICAgICAgICAgICAgdGV4dDogYCR7dGV4dH0gQWBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAobGV2ZWxfY3VycmVudCA9PSBsZXZlbCkge1xyXG4gICAgICAgICAgICBpZiAobGV2ZWxfY3VycmVudCAhPSA5MCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYOexs+a4uOekvuaVsOaNruaXoOazleWIpOaWreaYr+WQpueqgeegtCzor7foh6rooYzmr5TovoMke25hbWV95piv5ZCm5bey56qB56C0YClcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gY2hhcmFjdGVyU3RhdHVzO1xyXG4gICAgICAgIH0gZWxzZSBpZiAobGV2ZWxfY3VycmVudCA+PSBsZXZlbCkge1xyXG4gICAgICAgICAgICBpbml0Q2hhcmFjdGVyU3RhdHVzID0gY2hhcmFjdGVyU3RhdHVzXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIGluaXRDaGFyYWN0ZXJTdGF0dXM7XHJcbn07XHJcbiIsImltcG9ydCB7bW9ob3lvfSBmcm9tIFwiLi9AdHlwZS9tb2hveW9cIjtcclxuaW1wb3J0IFJlcyA9IG1vaG95by5SZXM7XHJcbmltcG9ydCBSb2xlID0gbW9ob3lvLlJvbGU7XHJcbmltcG9ydCBEYXRhID0gbW9ob3lvLkRhdGE7XHJcbmltcG9ydCBDaGFyYWN0ZXIgPSBtb2hveW8uQ2hhcmFjdGVyO1xyXG5pbXBvcnQgQ2hhcmFjdGVyRGF0YSA9IG1vaG95by5DaGFyYWN0ZXJEYXRhO1xyXG5pbXBvcnQgQ2hhcmFjdGVyRGF0YUV4ID0gbW9ob3lvLkNoYXJhY3RlckRhdGFFeDtcclxuaW1wb3J0IHtjb25maWd9IGZyb20gXCIuL2NvbmZpZ1wiO1xyXG5pbXBvcnQge0NvbmZpZ30gZnJvbSBcIi4vQHR5cGVcIjtcclxuaW1wb3J0IHthZGRDaGFyYWN0ZXJ9IGZyb20gXCIuL3NlZWxpZVwiO1xyXG5cclxuY29uc3QgbWlob3lvQWNjb3VudFN0ciA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKFwibWlob3lvQWNjb3VudFwiKTtcclxubGV0IG1paG95b0FjY291bnQ7XHJcbmlmIChtaWhveW9BY2NvdW50U3RyKSB7XHJcbiAgICBtaWhveW9BY2NvdW50ID0gSlNPTi5wYXJzZShtaWhveW9BY2NvdW50U3RyKSBhcyBDb25maWdcclxufVxyXG5sZXQge2dhbWVfdWlkLCByZWdpb24sIGFjY291bnRJZHh9ID0gbWlob3lvQWNjb3VudCB8fCBjb25maWdcclxuY29uc29sZS5sb2coXCJtaWhveW9BY2NvdW50XCIpO1xyXG5jb25zb2xlLmxvZyh7Z2FtZV91aWQsIHJlZ2lvbiwgYWNjb3VudElkeH0pO1xyXG5cclxuY29uc3QgQkJTX1VSTCA9ICdodHRwczovL2Jicy5taWhveW8uY29tL3lzLydcclxuY29uc3QgUk9MRV9VUkwgPSAnaHR0cHM6Ly9hcGktdGFrdW1pLm1paG95by5jb20vYmluZGluZy9hcGkvZ2V0VXNlckdhbWVSb2xlc0J5Q29va2llP2dhbWVfYml6PWhrNGVfY24nXHJcbmNvbnN0IENIQVJBQ1RFUlNfVVJMID0gJ2h0dHBzOi8vYXBpLXRha3VtaS5taWhveW8uY29tL2V2ZW50L2UyMDIwMDkyOGNhbGN1bGF0ZS92MS9zeW5jL2F2YXRhci9saXN0J1xyXG5jb25zdCBDSEFSQUNURVJTX0RFVEFJTF9VUkwgPSAnaHR0cHM6Ly9hcGktdGFrdW1pLm1paG95by5jb20vZXZlbnQvZTIwMjAwOTI4Y2FsY3VsYXRlL3YxL3N5bmMvYXZhdGFyL2RldGFpbCdcclxuXHJcbmZ1bmN0aW9uIG1ha2VHZXRSZXF1ZXN0KHVybDogc3RyaW5nKSB7XHJcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xyXG4gICAgICAgIEdNX3htbGh0dHBSZXF1ZXN0KHtcclxuICAgICAgICAgICAgbWV0aG9kOiBcIkdFVFwiLFxyXG4gICAgICAgICAgICB1cmw6IHVybCxcclxuICAgICAgICAgICAgb25sb2FkOiByZXNwb25zZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IEpTT04ucGFyc2UocmVzcG9uc2UucmVzcG9uc2VUZXh0KSBhcyBSZXM8YW55PjtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB7cmV0Y29kZSwgbWVzc2FnZSwgZGF0YX0gPSByZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJldGNvZGUgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QobWVzc2FnZSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZS5yZXNwb25zZVRleHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBvbmVycm9yOiAoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIG1ha2VQb3N0UmVxdWVzdCh1aWQ6IHN0cmluZywgcmVnaW9uOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgR01feG1saHR0cFJlcXVlc3Qoe1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxyXG4gICAgICAgICAgICB1cmw6IENIQVJBQ1RFUlNfVVJMLFxyXG4gICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeSh7XHJcbiAgICAgICAgICAgICAgICBcImVsZW1lbnRfYXR0cl9pZHNcIjogW10sXHJcbiAgICAgICAgICAgICAgICBcIndlYXBvbl9jYXRfaWRzXCI6IFtdLFxyXG4gICAgICAgICAgICAgICAgXCJwYWdlXCI6IDEsXHJcbiAgICAgICAgICAgICAgICBcInNpemVcIjogNTAsXHJcbiAgICAgICAgICAgICAgICBcInVpZFwiOiB1aWQsXHJcbiAgICAgICAgICAgICAgICBcInJlZ2lvblwiOiByZWdpb25cclxuICAgICAgICAgICAgfSksXHJcbiAgICAgICAgICAgIG9ubG9hZDogcmVzcG9uc2UgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PSAyMDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXMgPSBKU09OLnBhcnNlKHJlc3BvbnNlLnJlc3BvbnNlVGV4dCkgYXMgUmVzPENoYXJhY3Rlcj47XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qge3JldGNvZGUsIG1lc3NhZ2UsIGRhdGF9ID0gcmVzO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXRjb2RlID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KG1lc3NhZ2UpXHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICByZWplY3QocmVzcG9uc2UucmVzcG9uc2VUZXh0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgb25lcnJvcjogKGVycm9yOiBhbnkpID0+IHtcclxuICAgICAgICAgICAgICAgIHJlamVjdChlcnJvcik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5jb25zdCBnZXRBY2NvdW50ID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7bGlzdDogYWNjb3VudExpc3R9ID0gYXdhaXQgbWFrZUdldFJlcXVlc3QoUk9MRV9VUkwpIGFzIERhdGE8Um9sZT47XHJcbiAgICAgICAgcmV0dXJuIGFjY291bnRMaXN0O1xyXG4gICAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpXHJcbiAgICAgICAgYWxlcnQoXCLor7fnoa7orqTlt7LnmbvlvZXnsbPlk4jmuLjorrrlnZvkuJTnu5Hlrprljp/npZ7otKbmiLchXCIpXHJcbiAgICAgICAgR01fb3BlbkluVGFiKEJCU19VUkwpXHJcbiAgICAgICAgcmV0dXJuIFtdXHJcbiAgICB9XHJcbn07XHJcblxyXG5jb25zdCBnZXRDaGFyYWN0ZXJzID0gYXN5bmMgKHVpZDogc3RyaW5nLCByZWdpb246IHN0cmluZykgPT4ge1xyXG4gICAgY29uc3Qge2xpc3Q6IGNoYXJhY3Rlckxpc3R9ID0gYXdhaXQgbWFrZVBvc3RSZXF1ZXN0KHVpZCwgcmVnaW9uKSBhcyBEYXRhPENoYXJhY3Rlcj47XHJcbiAgICByZXR1cm4gY2hhcmFjdGVyTGlzdDtcclxufTtcclxuXHJcbmNvbnN0IGdldENoYXJhY3RlckRldGFpbCA9IGFzeW5jIChjaGFyYWN0ZXI6IENoYXJhY3RlciwgdWlkOiBzdHJpbmcsIHJlZ2lvbjogc3RyaW5nKSA9PiB7XHJcbiAgICBjb25zdCB7aWR9ID0gY2hhcmFjdGVyO1xyXG4gICAgY29uc3QgcGFyYW1zID0gYD9hdmF0YXJfaWQ9JHtpZH0mdWlkPSR7dWlkfSZyZWdpb249JHtyZWdpb259YFxyXG4gICAgbGV0IGNoYXJhY3RlckRhdGEgPSBhd2FpdCBtYWtlR2V0UmVxdWVzdChDSEFSQUNURVJTX0RFVEFJTF9VUkwgKyBwYXJhbXMpIGFzIENoYXJhY3RlckRhdGE7XHJcbiAgICByZXR1cm4ge2NoYXJhY3RlciwgLi4uY2hhcmFjdGVyRGF0YX0gYXMgQ2hhcmFjdGVyRGF0YUV4O1xyXG59O1xyXG5cclxuY29uc3QgZ2V0RGV0YWlsTGlzdCA9IGFzeW5jICgpID0+IHtcclxuICAgIGlmICghZ2FtZV91aWQgfHwgIXJlZ2lvbikge1xyXG4gICAgICAgIGNvbnN0IGFjY291bnRMaXN0OiBtb2hveW8uUm9sZVtdID0gYXdhaXQgZ2V0QWNjb3VudCgpO1xyXG4gICAgICAgIGlmIChhY2NvdW50TGlzdC5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwi6LSm5oi357uR5a6a6KeS6Imy5L+h5oGv6I635Y+W5aSx6LSlIVwiKVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoYWNjb3VudElkeCA+PSBhY2NvdW50TGlzdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgYWNjb3VudElkeCA9IGFjY291bnRMaXN0Lmxlbmd0aCAtIDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnN0IHtnYW1lX3VpZDogYVVpZCwgcmVnaW9uOiBhUmVnaW9ufSA9IGFjY291bnRMaXN0W2FjY291bnRJZHhdO1xyXG4gICAgICAgIGdhbWVfdWlkID0gYVVpZDtcclxuICAgICAgICByZWdpb24gPSBhUmVnaW9uID09IFwiY25fZ2YwMVwiID8gXCJjbl9nZjAxXCIgOiBcImNuX3FkMDFcIjtcclxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShcIm1paG95b0FjY291bnRcIiwgSlNPTi5zdHJpbmdpZnkoe2dhbWVfdWlkLCByZWdpb24sIGFjY291bnRJZHh9KSlcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjaGFyYWN0ZXJzID0gYXdhaXQgZ2V0Q2hhcmFjdGVycyhnYW1lX3VpZCwgcmVnaW9uKTtcclxuICAgIGNvbnN0IGRldGFpbHMgPSBjaGFyYWN0ZXJzLm1hcChjID0+IGdldENoYXJhY3RlckRldGFpbChjLCBnYW1lX3VpZCwgcmVnaW9uKSk7XHJcbiAgICBjb25zdCBkZXRhaWxMaXN0ID0gW107XHJcbiAgICBmb3IgYXdhaXQgKGxldCBkIG9mIGRldGFpbHMpIHtcclxuICAgICAgICBkZXRhaWxMaXN0LnB1c2goZCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGV0YWlsTGlzdDtcclxufVxyXG5cclxuXHJcbmdldERldGFpbExpc3QoKS50aGVuKFxyXG4gICAgcmVzID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhyZXMpO1xyXG4gICAgICAgIHJlcy5mb3JFYWNoKFxyXG4gICAgICAgICAgICB2ID0+IHtcclxuICAgICAgICAgICAgICAgIGFkZENoYXJhY3Rlcih2KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKVxyXG4gICAgfVxyXG4pXHJcbiJdLCJzb3VyY2VSb290IjoiIn0=