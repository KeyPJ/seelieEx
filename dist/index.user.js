// ==UserScript==
// @name               genshinSeelieEx
// @name:zh            原神规划助手扩展
// @description        description
// @description:zh     个人想偷懒,不想手动在仙灵 - 原神规划助手 手动录入角色及其天赋,于是简单整理一个脚本,利用米游社养成计算器api获取角色信息,直接导入至seelie
// @include            https://seelie.inmagi.com/*
// @require            https://cdn.jsdelivr.net/npm/core-js-bundle@3.9.1/index.js
// @grant              unsafeWindow
// @grant              GM_setValue
// @grant              GM_download
// @grant              GM_xmlhttpRequest
// @grant              GM_openInTab
// @grant              GM_getResourceText
// @resource           character    https://cdn.jsdelivr.net/gh/KeyPJ/seelieEx@main/src/data/character.json
// @resource           weapon    https://cdn.jsdelivr.net/gh/KeyPJ/seelieEx@main/src/data/weapon.json
// @author             KeyPJ
// @namespace          https://github.com/KeyPJ/seelieEx
// @icon               https://seelie.inmagi.com/img/icons/favicon-32x32.png
// @version            1.0.7
// @connect            api-takumi.mihoyo.com
// @run-at             document-end
// @homepage           https://github.com/KeyPJ
// @homepageURL        https://github.com/KeyPJ/seelieEx
// @copyright          2021, KeyPJ https://github.com/KeyPJ
// @license            MIT
// @contributionURL    https://github.com/KeyPJ/seelieEx
// ==/UserScript==

(()=>{"use strict";const e=JSON.parse(GM_getResourceText("character")),t=JSON.parse(GM_getResourceText("weapon")),o=[{element_attr_id:1,name:"pyro"},{element_attr_id:2,name:"anemo"},{element_attr_id:3,name:"geo"},{element_attr_id:4,name:"electro"},{element_attr_id:5,name:"hydro"},{element_attr_id:6,name:"cryo"},{element_attr_id:7,name:"dendro"}],n=()=>vue.goals,r=(e,t,o,r)=>{let a=n();const c=a.map((e=>e.id)),s=Math.max(...c)+1||1,i=a.findIndex("character"==r?e=>e.type==r&&e.character==t:e=>e.type==r&&e.weapon==t),u=l(e,o);let d;if(i<0)d="character"==r?{type:r,character:t,current:u,goal:u,id:s}:{type:r,character:"",weapon:t,current:u,goal:u,id:s};else{const e=a[i],{goal:t,current:o}=e,{level:n,asc:r}=o,{level:l,asc:c}=t,{level:s,asc:m}=u;d=Object.assign(Object.assign({},e),{current:s>=n&&m>=r?u:o,goal:s>=l&&m>=c?u:t})}vue.addGoal(d)};const a=[{level:1,asc:0,text:"1"},{level:20,asc:0,text:"20"},{level:40,asc:1,text:"40"},{level:50,asc:2,text:"50"},{level:60,asc:3,text:"60"},{level:70,asc:4,text:"70"},{level:80,asc:5,text:"80"},{level:90,asc:6,text:"90"}],l=(e,t)=>{let o=a[0];if(e<20)return o;for(let n of a){const{level:r}=n;if(e<r){const{asc:e,text:t}=o;return Object.assign(Object.assign({},o),{asc:e+1,text:`${t} A`})}if(e==r)return 90!=e&&console.log(`米游社数据无法判断是否突破,请自行比较${t}是否已突破`),n;e>=r&&(o=n)}return o};var c=function(e,t,o,n){return new(o||(o=Promise))((function(r,a){function l(e){try{s(n.next(e))}catch(e){a(e)}}function c(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(l,c)}s((n=n.apply(e,t||[])).next())}))};const s=localStorage.getItem("mihoyoAccount");let i;s&&(i=JSON.parse(s));let{game_uid:u,region:d,accountIdx:m}=i||{game_uid:"",region:"cn_qd01",accountIdx:0};function g(e){return new Promise(((t,o)=>{GM_xmlhttpRequest({method:"GET",url:e,onload:e=>{if(200==e.status){const n=JSON.parse(e.responseText),{retcode:r,message:a,data:l}=n;0===r?t(l):o(a)}else o(e.responseText)},onerror:e=>{o(e)}})}))}console.log("mihoyoAccount"),console.log({game_uid:u,region:d,accountIdx:m});c(void 0,void 0,void 0,(function*(){var e,t;if(!u||!d){const e=yield c(void 0,void 0,void 0,(function*(){try{const{list:e}=yield g("https://api-takumi.mihoyo.com/binding/api/getUserGameRolesByCookie?game_biz=hk4e_cn");return e}catch(e){return console.error(e),alert("请确认已登录米哈游论坛且绑定原神账户!"),GM_openInTab("https://bbs.mihoyo.com/ys/"),[]}}));if(0===e.length)throw new Error("账户绑定角色信息获取失败!");m>=e.length&&(m=e.length-1);const{game_uid:t,region:o}=e[m];u=t,d="cn_gf01"==o?"cn_gf01":"cn_qd01",localStorage.setItem("mihoyoAccount",JSON.stringify({game_uid:u,region:d,accountIdx:m}))}const o=(yield((e,t)=>c(void 0,void 0,void 0,(function*(){const{list:o}=yield function(e,t){return new Promise(((o,n)=>{GM_xmlhttpRequest({method:"POST",url:"https://api-takumi.mihoyo.com/event/e20200928calculate/v1/sync/avatar/list",data:JSON.stringify({element_attr_ids:[],weapon_cat_ids:[],page:1,size:50,uid:e,region:t}),onload:e=>{if(200==e.status){const t=JSON.parse(e.responseText),{retcode:r,message:a,data:l}=t;0===r?o(l):n(a)}else n(e.responseText)},onerror:e=>{n(e)}})}))}(e,t);return o})))(u,d)).map((e=>((e,t,o)=>c(void 0,void 0,void 0,(function*(){const{id:n}=e,r=`?avatar_id=${n}&uid=${t}&region=${o}`;let a=yield g("https://api-takumi.mihoyo.com/event/e20200928calculate/v1/sync/avatar/detail"+r);return Object.assign({character:e},a)})))(e,u,d))),n=[];try{for(var r,a=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,o=e[Symbol.asyncIterator];return o?o.call(e):(e="function"==typeof __values?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=e[o]&&function(t){return new Promise((function(n,r){!function(e,t,o,n){Promise.resolve(n).then((function(t){e({value:t,done:o})}),t)}(n,r,(t=e[o](t)).done,t.value)}))}}}(o);!(r=yield a.next()).done;){let e=r.value;n.push(e)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=a.return)&&(yield t.call(a))}finally{if(e)throw e.error}}return n})).then((a=>{console.group("返回数据"),console.groupCollapsed("角色"),console.table(a.map((e=>e.character))),console.groupEnd(),console.groupCollapsed("武器"),console.table(a.map((e=>e.weapon))),console.groupEnd(),console.groupCollapsed("角色天赋"),a.forEach((e=>{const t=e.character.name;console.groupCollapsed(t),console.table(e.skill_list),console.groupEnd()})),console.groupEnd(),console.groupEnd(),a.forEach((a=>{!function(a){const{character:l,skill_list:c,weapon:s}=a,{name:i,element_attr_id:u}=l;if(s){const{name:e,level_current:o}=s,n=(e=>{for(let o of t){const{id:t,name:n}=o;if(e==n)return t}return console.error(`getWeaponrId ${e} 查询失败`),""})(e);console.log(n,e),n&&r(o,n,e,"weapon")}const{level_current:d}=l,m=(t=>{for(let o of e){const{id:e,name:n}=o;if(t==n)return e}return console.error(`getCharacterId ${t} 查询失败`),""})(i);if(!m)return;r(d,m,i,"character");let g=m;"traveler"==m&&(g=`traveler_${(e=>{for(let t of o){const{element_attr_id:o,name:n}=t;if(e==o)return n}return console.error(`getElementAttrName: ${e} 查询失败`),""})(u)}`),((e,t)=>{const o=n(),r=o.map((e=>e.id)),a=Math.max(...r)+1||1,l=o.findIndex((t=>"talent"==t.type&&t.character==e)),[c,s,i]=t.filter((e=>10==e.max_level)).sort().map((e=>e.level_current));let u;if(console.log(e,[c,s,i]),l<0)u={type:"talent",character:e,c3:!1,c5:!1,normal:{current:c,goal:c},skill:{current:s,goal:s},burst:{current:i,goal:i},id:a};else{const e=o[l],{normal:t,skill:n,burst:r}=e,{goal:a}=t,{goal:d}=n,{goal:m}=r;u=Object.assign(Object.assign({},e),{normal:{current:c,goal:c>a?c:a},skill:{current:s,goal:s>d?s:d},burst:{current:i,goal:i>m?i:m}})}vue.addGoal(u)})(g,c)}(a)}))}))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90YW1wZXJtb25rZXktd2VicGFjay10ZW1wbGF0ZS8uL3NyYy9jb25maWcudHMiLCJ3ZWJwYWNrOi8vdGFtcGVybW9ua2V5LXdlYnBhY2stdGVtcGxhdGUvLi9zcmMvcXVlcnkudHMiLCJ3ZWJwYWNrOi8vdGFtcGVybW9ua2V5LXdlYnBhY2stdGVtcGxhdGUvLi9zcmMvc2VlbGllLnRzIiwid2VicGFjazovL3RhbXBlcm1vbmtleS13ZWJwYWNrLXRlbXBsYXRlLy4vc3JjL2luZGV4LnRzIl0sIm5hbWVzIjpbImNoYXJhY3RlcnMiLCJKU09OIiwicGFyc2UiLCJHTV9nZXRSZXNvdXJjZVRleHQiLCJ3ZWFwb25zIiwiZWxlbWVudEF0dHJJZHMiLCJlbGVtZW50X2F0dHJfaWQiLCJuYW1lIiwiZ2V0VG90YWxHb2FsIiwidnVlIiwiZ29hbHMiLCJhZGRDaGFyYWN0ZXJHb2FsIiwibGV2ZWxfY3VycmVudCIsIm5hbWVFbiIsInR5cGUiLCJ0b3RhbEdvYWwiLCJpZHMiLCJtYXAiLCJnIiwiaWQiLCJNYXRoIiwibWF4IiwiY2hhcmFjdGVySWR4IiwiZmluZEluZGV4IiwiY2hhcmFjdGVyIiwid2VhcG9uIiwiY2hhcmFjdGVyU3RhdHVzIiwiaW5pdENoYXJhY3RlclN0YXR1cyIsImNoYXJhY3RlckdvYWwiLCJjdXJyZW50IiwiZ29hbCIsInNlZWxpZUdvYWwiLCJsZXZlbCIsImxldmVsQ3VycmVudCIsImFzYyIsImFzY0N1cnJlbnQiLCJsZXZlbEdvYWwiLCJhc2NHb2FsIiwiYWRkR29hbCIsImNoYXJhY3RlclN0YXR1c0xpc3QiLCJ0ZXh0IiwiY29uc29sZSIsImxvZyIsIm1paG95b0FjY291bnRTdHIiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwibWlob3lvQWNjb3VudCIsImdhbWVfdWlkIiwicmVnaW9uIiwiYWNjb3VudElkeCIsIm1ha2VHZXRSZXF1ZXN0IiwidXJsIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJHTV94bWxodHRwUmVxdWVzdCIsIm1ldGhvZCIsIm9ubG9hZCIsInJlc3BvbnNlIiwic3RhdHVzIiwicmVzIiwicmVzcG9uc2VUZXh0IiwicmV0Y29kZSIsIm1lc3NhZ2UiLCJkYXRhIiwib25lcnJvciIsImVycm9yIiwiYWNjb3VudExpc3QiLCJsaXN0IiwiZXJyIiwiYWxlcnQiLCJHTV9vcGVuSW5UYWIiLCJsZW5ndGgiLCJFcnJvciIsImFVaWQiLCJhUmVnaW9uIiwic2V0SXRlbSIsInN0cmluZ2lmeSIsImRldGFpbHMiLCJ1aWQiLCJjaGFyYWN0ZXJMaXN0IiwibWFrZVBvc3RSZXF1ZXN0IiwiZ2V0Q2hhcmFjdGVycyIsImMiLCJwYXJhbXMiLCJjaGFyYWN0ZXJEYXRhIiwiZ2V0Q2hhcmFjdGVyRGV0YWlsIiwiZGV0YWlsTGlzdCIsImQiLCJwdXNoIiwidGhlbiIsImdyb3VwIiwiZ3JvdXBDb2xsYXBzZWQiLCJ0YWJsZSIsImEiLCJncm91cEVuZCIsImZvckVhY2giLCJza2lsbF9saXN0IiwidiIsImNoYXJhY3RlckRhdGFFeCIsIndlYXBvbkxldmVMIiwid2VhcG9uSWQiLCJxdWVyeU5hbWUiLCJlIiwiZ2V0V2VhcG9uSWQiLCJjaGFyYWN0ZXJMZXZlbCIsImNoYXJhY3RlcklkIiwiZ2V0Q2hhcmFjdGVySWQiLCJ0YWxlbnRDaGFyYWN0ZXIiLCJnZXRFbGVtZW50QXR0ck5hbWUiLCJ0YWxlbnRJZHgiLCJub3JtYWxDdXJyZW50Iiwic2tpbGxDdXJyZW50IiwiYnVyc3RDdXJyZW50IiwiZmlsdGVyIiwibWF4X2xldmVsIiwic29ydCIsInRhbGVudEdvYWwiLCJjMyIsImM1Iiwibm9ybWFsIiwic2tpbGwiLCJidXJzdCIsIm5vcm1hbEdvYWwiLCJza2lsbEdvYWwiLCJidXJzdEdvYWwiLCJhZGRUYWxlbnRHb2FsIiwiYWRkQ2hhcmFjdGVyIl0sIm1hcHBpbmdzIjoibUJBRU8sTUNHREEsRUFBYUMsS0FBS0MsTUFBTUMsbUJBQW1CLGNBQzNDQyxFQUFVSCxLQUFLQyxNQUFNQyxtQkFBbUIsV0F3QnhDRSxFQUFpQixD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Q3BERixNQUFPLENBQ041RixRQUFTbUYsRUFDVGxGLEtBQU1rRixFQUFlWSxFQUFZWixFQUFlWSxHQUNqREYsTUFBTyxDQUNON0YsUUFBU29GLEVBQ1RuRixLQUFNbUYsRUFBZVksRUFBWVosRUFBZVksS0FLNURwSCxJQUFJNkIsUUFBUStFLElBbUZaUyxDQUFjbEIsRUFBaUJYLEdDTW5COEIsQ0FBYTdCLFUiLCJmaWxlIjoiaW5kZXgudXNlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7Q29uZmlnfSBmcm9tIFwiLi9AdHlwZVwiO1xyXG5cclxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcclxuICAgIGdhbWVfdWlkOiBcIlwiLC8vNTAxNzI1MTcyXHJcbiAgICByZWdpb246IFwiY25fcWQwMVwiLC8vXHJcbiAgICBhY2NvdW50SWR4OiAwXHJcbn0gYXMgQ29uZmlnO1xyXG4iLCJpbnRlcmZhY2UgcXVlcnlOYW1lIHtcclxuICAgIGlkOiBzdHJpbmcsXHJcbiAgICBuYW1lOiBzdHJpbmdcclxufVxyXG5cclxuY29uc3QgY2hhcmFjdGVycyA9IEpTT04ucGFyc2UoR01fZ2V0UmVzb3VyY2VUZXh0KFwiY2hhcmFjdGVyXCIpKSBhcyBxdWVyeU5hbWVbXTtcclxuY29uc3Qgd2VhcG9ucyA9IEpTT04ucGFyc2UoR01fZ2V0UmVzb3VyY2VUZXh0KFwid2VhcG9uXCIpKSBhcyBxdWVyeU5hbWVbXTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXRDaGFyYWN0ZXJJZCA9IChxdWVyeU5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgZm9yIChsZXQgZSBvZiBjaGFyYWN0ZXJzKSB7XHJcbiAgICAgICAgY29uc3Qge2lkLCBuYW1lfSA9IGVcclxuICAgICAgICBpZiAocXVlcnlOYW1lID09IG5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGlkO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbnNvbGUuZXJyb3IoYGdldENoYXJhY3RlcklkICR7cXVlcnlOYW1lfSDmn6Xor6LlpLHotKVgKVxyXG4gICAgcmV0dXJuIFwiXCJcclxufTtcclxuXHJcbmV4cG9ydCBjb25zdCBnZXRXZWFwb25JZCA9IChxdWVyeU5hbWU6IHN0cmluZykgPT4ge1xyXG4gICAgZm9yIChsZXQgZSBvZiB3ZWFwb25zKSB7XHJcbiAgICAgICAgY29uc3Qge2lkLCBuYW1lfSA9IGVcclxuICAgICAgICBpZiAocXVlcnlOYW1lID09IG5hbWUpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGlkO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGNvbnNvbGUuZXJyb3IoYGdldFdlYXBvbnJJZCAke3F1ZXJ5TmFtZX0g5p+l6K+i5aSx6LSlYClcclxuICAgIHJldHVybiBcIlwiXHJcbn07XHJcblxyXG5jb25zdCBlbGVtZW50QXR0cklkcyA9IFtcclxuICAgIHtlbGVtZW50X2F0dHJfaWQ6IDEsIG5hbWU6IFwicHlyb1wifSxcclxuICAgIHtlbGVtZW50X2F0dHJfaWQ6IDIsIG5hbWU6IFwiYW5lbW9cIn0sXHJcbiAgICB7ZWxlbWVudF9hdHRyX2lkOiAzLCBuYW1lOiBcImdlb1wifSxcclxuICAgIHtlbGVtZW50X2F0dHJfaWQ6IDQsIG5hbWU6IFwiZWxlY3Ryb1wifSxcclxuICAgIHtlbGVtZW50X2F0dHJfaWQ6IDUsIG5hbWU6IFwiaHlkcm9cIn0sXHJcbiAgICB7ZWxlbWVudF9hdHRyX2lkOiA2LCBuYW1lOiBcImNyeW9cIn0sXHJcbiAgICB7ZWxlbWVudF9hdHRyX2lkOiA3LCBuYW1lOiBcImRlbmRyb1wifSxcclxuXVxyXG5cclxuXHJcbmV4cG9ydCBjb25zdCBnZXRFbGVtZW50QXR0ck5hbWUgPSAocXVlcnlOYW1lOiBudW1iZXIpID0+IHtcclxuXHJcbiAgICBmb3IgKGxldCBlIG9mIGVsZW1lbnRBdHRySWRzKSB7XHJcbiAgICAgICAgY29uc3Qge2VsZW1lbnRfYXR0cl9pZCwgbmFtZX0gPSBlXHJcbiAgICAgICAgaWYgKHF1ZXJ5TmFtZSA9PSBlbGVtZW50X2F0dHJfaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc29sZS5lcnJvcihgZ2V0RWxlbWVudEF0dHJOYW1lOiAke3F1ZXJ5TmFtZX0g5p+l6K+i5aSx6LSlYClcclxuICAgIHJldHVybiBcIlwiXHJcbn07XHJcbiIsImltcG9ydCBHb2FsID0gc2VlbGllLkdvYWw7XHJcbmltcG9ydCB7bW9ob3lvfSBmcm9tIFwiLi9AdHlwZS9tb2hveW9cIjtcclxuaW1wb3J0IENoYXJhY3RlckRhdGFFeCA9IG1vaG95by5DaGFyYWN0ZXJEYXRhRXg7XHJcbmltcG9ydCBDaGFyYWN0ZXJTdGF0dXMgPSBzZWVsaWUuQ2hhcmFjdGVyU3RhdHVzO1xyXG5pbXBvcnQgQ2hhcmFjdGVyR29hbCA9IHNlZWxpZS5DaGFyYWN0ZXJHb2FsO1xyXG5pbXBvcnQgVGFsZW50R29hbCA9IHNlZWxpZS5UYWxlbnRHb2FsO1xyXG5pbXBvcnQge2dldENoYXJhY3RlcklkLCBnZXRFbGVtZW50QXR0ck5hbWUsIGdldFdlYXBvbklkfSBmcm9tIFwiLi9xdWVyeVwiO1xyXG5pbXBvcnQgV2VhcG9uR29hbCA9IHNlZWxpZS5XZWFwb25Hb2FsO1xyXG5cclxuXHJcbmV4cG9ydCBjb25zdCBnZXRUb3RhbEdvYWwgPSAoKSA9PiB7XHJcbiAgICAvLyBAdHMtaWdub3JlXHJcbiAgICBjb25zdCBnb2FsczogR29hbFtdID0gdnVlLmdvYWxzO1xyXG4gICAgcmV0dXJuIGdvYWxzO1xyXG59O1xyXG5cclxuY29uc3QgYWRkVGFsZW50R29hbCA9ICh0YWxlbnRDaGFyYWN0ZXI6IHN0cmluZywgc2tpbGxfbGlzdDogbW9ob3lvLlNraWxsW10pID0+IHtcclxuICAgIGNvbnN0IHRvdGFsR29hbDogR29hbFtdID0gZ2V0VG90YWxHb2FsKCk7XHJcbiAgICBjb25zdCBpZHMgPSB0b3RhbEdvYWwubWFwKGcgPT4gZy5pZCk7XHJcbiAgICBjb25zdCBpZCA9IE1hdGgubWF4KC4uLmlkcykgKyAxIHx8IDE7XHJcbiAgICBjb25zdCB0YWxlbnRJZHggPSB0b3RhbEdvYWwuZmluZEluZGV4KGcgPT4gZy50eXBlID09IFwidGFsZW50XCIgJiYgZy5jaGFyYWN0ZXIgPT0gdGFsZW50Q2hhcmFjdGVyKTtcclxuICAgIGNvbnN0IFtub3JtYWxDdXJyZW50LCBza2lsbEN1cnJlbnQsIGJ1cnN0Q3VycmVudF0gPSBza2lsbF9saXN0LmZpbHRlcihhID0+IGEubWF4X2xldmVsID09IDEwKS5zb3J0KCkubWFwKGEgPT4gYS5sZXZlbF9jdXJyZW50KVxyXG4gICAgY29uc29sZS5sb2codGFsZW50Q2hhcmFjdGVyLCBbbm9ybWFsQ3VycmVudCwgc2tpbGxDdXJyZW50LCBidXJzdEN1cnJlbnRdKVxyXG4gICAgbGV0IHRhbGVudEdvYWw6IFRhbGVudEdvYWw7XHJcbiAgICBpZiAodGFsZW50SWR4IDwgMCkge1xyXG4gICAgICAgIHRhbGVudEdvYWwgPSB7XHJcbiAgICAgICAgICAgIHR5cGU6IFwidGFsZW50XCIsXHJcbiAgICAgICAgICAgIGNoYXJhY3RlcjogdGFsZW50Q2hhcmFjdGVyLFxyXG4gICAgICAgICAgICBjMzogZmFsc2UsXHJcbiAgICAgICAgICAgIGM1OiBmYWxzZSxcclxuICAgICAgICAgICAgbm9ybWFsOiB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50OiBub3JtYWxDdXJyZW50LFxyXG4gICAgICAgICAgICAgICAgZ29hbDogbm9ybWFsQ3VycmVudFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBza2lsbDoge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudDogc2tpbGxDdXJyZW50LFxyXG4gICAgICAgICAgICAgICAgZ29hbDogc2tpbGxDdXJyZW50XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGJ1cnN0OiB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50OiBidXJzdEN1cnJlbnQsXHJcbiAgICAgICAgICAgICAgICBnb2FsOiBidXJzdEN1cnJlbnRcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgaWRcclxuICAgICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IHNlZWxpZUdvYWwgPSB0b3RhbEdvYWxbdGFsZW50SWR4XSBhcyBUYWxlbnRHb2FsO1xyXG4gICAgICAgIGNvbnN0IHtub3JtYWwsIHNraWxsLCBidXJzdH0gPSBzZWVsaWVHb2FsO1xyXG4gICAgICAgIGNvbnN0IHtnb2FsOiBub3JtYWxHb2FsfSA9IG5vcm1hbDtcclxuICAgICAgICBjb25zdCB7Z29hbDogc2tpbGxHb2FsfSA9IHNraWxsO1xyXG4gICAgICAgIGNvbnN0IHtnb2FsOiBidXJzdEdvYWx9ID0gYnVyc3Q7XHJcbiAgICAgICAgdGFsZW50R29hbCA9IHtcclxuICAgICAgICAgICAgLi4uc2VlbGllR29hbCxcclxuICAgICAgICAgICAgbm9ybWFsOiB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50OiBub3JtYWxDdXJyZW50LFxyXG4gICAgICAgICAgICAgICAgZ29hbDogbm9ybWFsQ3VycmVudCA+IG5vcm1hbEdvYWwgPyBub3JtYWxDdXJyZW50IDogbm9ybWFsR29hbFxyXG4gICAgICAgICAgICB9LCBza2lsbDoge1xyXG4gICAgICAgICAgICAgICAgY3VycmVudDogc2tpbGxDdXJyZW50LFxyXG4gICAgICAgICAgICAgICAgZ29hbDogc2tpbGxDdXJyZW50ID4gc2tpbGxHb2FsID8gc2tpbGxDdXJyZW50IDogc2tpbGxHb2FsXHJcbiAgICAgICAgICAgIH0sIGJ1cnN0OiB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZW50OiBidXJzdEN1cnJlbnQsXHJcbiAgICAgICAgICAgICAgICBnb2FsOiBidXJzdEN1cnJlbnQgPiBidXJzdEdvYWwgPyBidXJzdEN1cnJlbnQgOiBidXJzdEdvYWxcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIEB0cy1pZ25vcmVcclxuICAgIHZ1ZS5hZGRHb2FsKHRhbGVudEdvYWwpXHJcbn07XHJcblxyXG5leHBvcnQgY29uc3QgYWRkQ2hhcmFjdGVyR29hbCA9IChsZXZlbF9jdXJyZW50OiBudW1iZXIsIG5hbWVFbjogU3RyaW5nLCBuYW1lOiBzdHJpbmcsIHR5cGU6IHN0cmluZykgPT4ge1xyXG4gICAgbGV0IHRvdGFsR29hbDogR29hbFtdID0gZ2V0VG90YWxHb2FsKCk7XHJcbiAgICBjb25zdCBpZHMgPSB0b3RhbEdvYWwubWFwKGcgPT4gZy5pZCk7XHJcbiAgICBjb25zdCBpZCA9IE1hdGgubWF4KC4uLmlkcykgKyAxIHx8IDE7XHJcbiAgICBsZXQgY2hhcmFjdGVyUHJlZGljYXRlID0gKGc6IEdvYWwpID0+IGcudHlwZSA9PSB0eXBlICYmIGcuY2hhcmFjdGVyID09IG5hbWVFbjtcclxuICAgIGxldCB3ZWFwb25QcmVkaWNhdGUgPSAoZzogR29hbCkgPT4gZy50eXBlID09IHR5cGUgJiYgZy53ZWFwb24gPT0gbmFtZUVuO1xyXG4gICAgY29uc3QgY2hhcmFjdGVySWR4ID0gdG90YWxHb2FsLmZpbmRJbmRleCh0eXBlID09IFwiY2hhcmFjdGVyXCIgPyBjaGFyYWN0ZXJQcmVkaWNhdGUgOiB3ZWFwb25QcmVkaWNhdGUpO1xyXG4gICAgY29uc3QgY2hhcmFjdGVyU3RhdHVzOiBDaGFyYWN0ZXJTdGF0dXMgPSBpbml0Q2hhcmFjdGVyU3RhdHVzKGxldmVsX2N1cnJlbnQsIG5hbWUpO1xyXG5cclxuICAgIGxldCBjaGFyYWN0ZXJHb2FsOiBHb2FsXHJcblxyXG4gICAgZnVuY3Rpb24gaW5pdENoYXJhY3RlckdvYWwoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgdHlwZSxcclxuICAgICAgICAgICAgY2hhcmFjdGVyOiBuYW1lRW4sXHJcbiAgICAgICAgICAgIGN1cnJlbnQ6IGNoYXJhY3RlclN0YXR1cyxcclxuICAgICAgICAgICAgZ29hbDogY2hhcmFjdGVyU3RhdHVzLFxyXG4gICAgICAgICAgICBpZFxyXG4gICAgICAgIH0gYXMgQ2hhcmFjdGVyR29hbFxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGluaXRXZWFwb25Hb2FsKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHR5cGUsXHJcbiAgICAgICAgICAgIGNoYXJhY3RlcjogXCJcIixcclxuICAgICAgICAgICAgd2VhcG9uOiBuYW1lRW4sXHJcbiAgICAgICAgICAgIGN1cnJlbnQ6IGNoYXJhY3RlclN0YXR1cyxcclxuICAgICAgICAgICAgZ29hbDogY2hhcmFjdGVyU3RhdHVzLFxyXG4gICAgICAgICAgICBpZFxyXG4gICAgICAgIH0gYXMgV2VhcG9uR29hbFxyXG4gICAgfVxyXG5cclxuICAgIGlmIChjaGFyYWN0ZXJJZHggPCAwKSB7XHJcbiAgICAgICAgY2hhcmFjdGVyR29hbCA9IHR5cGUgPT0gXCJjaGFyYWN0ZXJcIiA/IGluaXRDaGFyYWN0ZXJHb2FsKCkgOiBpbml0V2VhcG9uR29hbCgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBzZWVsaWVHb2FsID0gdHlwZSA9PSBcImNoYXJhY3RlclwiID8gdG90YWxHb2FsW2NoYXJhY3RlcklkeF0gYXMgQ2hhcmFjdGVyR29hbCA6IHRvdGFsR29hbFtjaGFyYWN0ZXJJZHhdIGFzIFdlYXBvbkdvYWxcclxuICAgICAgICBjb25zdCB7Z29hbCwgY3VycmVudH0gPSBzZWVsaWVHb2FsO1xyXG4gICAgICAgIGNvbnN0IHtsZXZlbDogbGV2ZWxDdXJyZW50LCBhc2M6IGFzY0N1cnJlbnR9ID0gY3VycmVudDtcclxuICAgICAgICBjb25zdCB7bGV2ZWw6IGxldmVsR29hbCwgYXNjOiBhc2NHb2FsfSA9IGdvYWw7XHJcbiAgICAgICAgY29uc3Qge2xldmVsLCBhc2N9ID0gY2hhcmFjdGVyU3RhdHVzO1xyXG5cclxuICAgICAgICBjaGFyYWN0ZXJHb2FsID0ge1xyXG4gICAgICAgICAgICAuLi5zZWVsaWVHb2FsLFxyXG4gICAgICAgICAgICBjdXJyZW50OiBsZXZlbCA+PSBsZXZlbEN1cnJlbnQgJiYgYXNjID49IGFzY0N1cnJlbnQgPyBjaGFyYWN0ZXJTdGF0dXMgOiBjdXJyZW50LFxyXG4gICAgICAgICAgICBnb2FsOiBsZXZlbCA+PSBsZXZlbEdvYWwgJiYgYXNjID49IGFzY0dvYWwgPyBjaGFyYWN0ZXJTdGF0dXMgOiBnb2FsLFxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8vIEB0cy1pZ25vcmVcclxuICAgIHR5cGUgPT0gXCJjaGFyYWN0ZXJcIiA/IHZ1ZS5hZGRHb2FsKGNoYXJhY3RlckdvYWwgYXMgQ2hhcmFjdGVyR29hbCkgOiB2dWUuYWRkR29hbChjaGFyYWN0ZXJHb2FsIGFzIFdlYXBvbkdvYWwpXHJcbn07XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gYWRkQ2hhcmFjdGVyKGNoYXJhY3RlckRhdGFFeDogQ2hhcmFjdGVyRGF0YUV4KSB7XHJcblxyXG4gICAgY29uc3Qge2NoYXJhY3Rlciwgc2tpbGxfbGlzdCwgd2VhcG9ufSA9IGNoYXJhY3RlckRhdGFFeDtcclxuICAgIGNvbnN0IHtuYW1lLCBlbGVtZW50X2F0dHJfaWR9ID0gY2hhcmFjdGVyO1xyXG5cclxuICAgIC8ve1widHlwZVwiOlwiY2hhcmFjdGVyXCIsXCJjaGFyYWN0ZXJcIjpcInRyYXZlbGVyXCIsXCJjdXJyZW50XCI6e1wibGV2ZWxcIjo3MCxcImFzY1wiOjQsXCJ0ZXh0XCI6XCI3MFwifSxcImdvYWxcIjp7XCJsZXZlbFwiOjcwLFwiYXNjXCI6NCxcInRleHRcIjpcIjcwXCJ9LFwiaWRcIjoxfSxcclxuICAgIC8ve1widHlwZVwiOlwid2VhcG9uXCIsXCJ3ZWFwb25cIjpcIlwiZGVhdGhtYXRjaFwiXCIsXCJjdXJyZW50XCI6e1wibGV2ZWxcIjo3MCxcImFzY1wiOjQsXCJ0ZXh0XCI6XCI3MFwifSxcImdvYWxcIjp7XCJsZXZlbFwiOjcwLFwiYXNjXCI6NCxcInRleHRcIjpcIjcwXCJ9LFwiaWRcIjoxfSxcclxuICAgIC8ve1widHlwZVwiOlwidGFsZW50XCIsXCJjaGFyYWN0ZXJcIjpcInRyYXZlbGVyX2dlb1wiLFwiYzNcIjpmYWxzZSxcImM1XCI6ZmFsc2UsXCJub3JtYWxcIjp7XCJjdXJyZW50XCI6MSxcImdvYWxcIjo2fSxcInNraWxsXCI6e1wiY3VycmVudFwiOjEsXCJnb2FsXCI6Nn0sXCJidXJzdFwiOntcImN1cnJlbnRcIjoxLFwiZ29hbFwiOjZ9LFwiaWRcIjoyfVxyXG5cclxuICAgIGlmICh3ZWFwb24pIHtcclxuICAgICAgICBjb25zdCB7bmFtZSwgbGV2ZWxfY3VycmVudDogd2VhcG9uTGV2ZUx9ID0gd2VhcG9uO1xyXG4gICAgICAgIGNvbnN0IHdlYXBvbklkID0gZ2V0V2VhcG9uSWQobmFtZSk7XHJcbiAgICAgICAgY29uc29sZS5sb2cod2VhcG9uSWQsIG5hbWUpO1xyXG4gICAgICAgIGlmICh3ZWFwb25JZCkge1xyXG4gICAgICAgICAgICBhZGRDaGFyYWN0ZXJHb2FsKHdlYXBvbkxldmVMLCB3ZWFwb25JZCwgbmFtZSwgXCJ3ZWFwb25cIik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgY29uc3Qge2xldmVsX2N1cnJlbnQ6IGNoYXJhY3RlckxldmVsfSA9IGNoYXJhY3RlcjtcclxuICAgIGNvbnN0IGNoYXJhY3RlcklkID0gZ2V0Q2hhcmFjdGVySWQobmFtZSk7XHJcbiAgICBpZiAoIWNoYXJhY3RlcklkKSB7XHJcbiAgICAgICAgcmV0dXJuXHJcbiAgICB9XHJcbiAgICBhZGRDaGFyYWN0ZXJHb2FsKGNoYXJhY3RlckxldmVsLCBjaGFyYWN0ZXJJZCwgbmFtZSwgXCJjaGFyYWN0ZXJcIik7XHJcblxyXG4gICAgbGV0IHRhbGVudENoYXJhY3RlciA9IGNoYXJhY3RlcklkO1xyXG4gICAgaWYgKGNoYXJhY3RlcklkID09IFwidHJhdmVsZXJcIikge1xyXG4gICAgICAgIGNvbnN0IGVsZW1lbnRBdHRyTmFtZSA9IGdldEVsZW1lbnRBdHRyTmFtZShlbGVtZW50X2F0dHJfaWQpO1xyXG4gICAgICAgIHRhbGVudENoYXJhY3RlciA9IGB0cmF2ZWxlcl8ke2VsZW1lbnRBdHRyTmFtZX1gO1xyXG4gICAgfVxyXG4gICAgYWRkVGFsZW50R29hbCh0YWxlbnRDaGFyYWN0ZXIsIHNraWxsX2xpc3QpO1xyXG5cclxufVxyXG5cclxuY29uc3QgY2hhcmFjdGVyU3RhdHVzTGlzdDogQ2hhcmFjdGVyU3RhdHVzW10gPSBbXHJcbiAgICB7bGV2ZWw6IDEsIGFzYzogMCwgdGV4dDogXCIxXCJ9LFxyXG4gICAge2xldmVsOiAyMCwgYXNjOiAwLCB0ZXh0OiBcIjIwXCJ9LFxyXG4gICAge2xldmVsOiA0MCwgYXNjOiAxLCB0ZXh0OiBcIjQwXCJ9LFxyXG4gICAge2xldmVsOiA1MCwgYXNjOiAyLCB0ZXh0OiBcIjUwXCJ9LFxyXG4gICAge2xldmVsOiA2MCwgYXNjOiAzLCB0ZXh0OiBcIjYwXCJ9LFxyXG4gICAge2xldmVsOiA3MCwgYXNjOiA0LCB0ZXh0OiBcIjcwXCJ9LFxyXG4gICAge2xldmVsOiA4MCwgYXNjOiA1LCB0ZXh0OiBcIjgwXCJ9LFxyXG4gICAge2xldmVsOiA5MCwgYXNjOiA2LCB0ZXh0OiBcIjkwXCJ9LFxyXG5dXHJcblxyXG5jb25zdCBpbml0Q2hhcmFjdGVyU3RhdHVzID0gKGxldmVsX2N1cnJlbnQ6IG51bWJlciwgbmFtZTogc3RyaW5nKSA9PiB7XHJcbiAgICBsZXQgaW5pdENoYXJhY3RlclN0YXR1cyA9IGNoYXJhY3RlclN0YXR1c0xpc3RbMF07XHJcbiAgICBpZiAobGV2ZWxfY3VycmVudCA8IDIwKSB7XHJcbiAgICAgICAgcmV0dXJuIGluaXRDaGFyYWN0ZXJTdGF0dXM7XHJcbiAgICB9XHJcbiAgICBmb3IgKGxldCBjaGFyYWN0ZXJTdGF0dXMgb2YgY2hhcmFjdGVyU3RhdHVzTGlzdCkge1xyXG4gICAgICAgIGNvbnN0IHtsZXZlbH0gPSBjaGFyYWN0ZXJTdGF0dXM7XHJcbiAgICAgICAgaWYgKGxldmVsX2N1cnJlbnQgPCBsZXZlbCkge1xyXG4gICAgICAgICAgICBjb25zdCB7YXNjLCB0ZXh0fSA9IGluaXRDaGFyYWN0ZXJTdGF0dXNcclxuICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgIC4uLmluaXRDaGFyYWN0ZXJTdGF0dXMsXHJcbiAgICAgICAgICAgICAgICBhc2M6IGFzYyArIDEsXHJcbiAgICAgICAgICAgICAgICB0ZXh0OiBgJHt0ZXh0fSBBYFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIGlmIChsZXZlbF9jdXJyZW50ID09IGxldmVsKSB7XHJcbiAgICAgICAgICAgIGlmIChsZXZlbF9jdXJyZW50ICE9IDkwKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhg57Gz5ri456S+5pWw5o2u5peg5rOV5Yik5pat5piv5ZCm56qB56C0LOivt+iHquihjOavlOi+gyR7bmFtZX3mmK/lkKblt7LnqoHnoLRgKVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJldHVybiBjaGFyYWN0ZXJTdGF0dXM7XHJcbiAgICAgICAgfSBlbHNlIGlmIChsZXZlbF9jdXJyZW50ID49IGxldmVsKSB7XHJcbiAgICAgICAgICAgIGluaXRDaGFyYWN0ZXJTdGF0dXMgPSBjaGFyYWN0ZXJTdGF0dXNcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICByZXR1cm4gaW5pdENoYXJhY3RlclN0YXR1cztcclxufTtcclxuIiwiaW1wb3J0IHttb2hveW99IGZyb20gXCIuL0B0eXBlL21vaG95b1wiO1xyXG5pbXBvcnQgUmVzID0gbW9ob3lvLlJlcztcclxuaW1wb3J0IFJvbGUgPSBtb2hveW8uUm9sZTtcclxuaW1wb3J0IERhdGEgPSBtb2hveW8uRGF0YTtcclxuaW1wb3J0IENoYXJhY3RlciA9IG1vaG95by5DaGFyYWN0ZXI7XHJcbmltcG9ydCBDaGFyYWN0ZXJEYXRhID0gbW9ob3lvLkNoYXJhY3RlckRhdGE7XHJcbmltcG9ydCBDaGFyYWN0ZXJEYXRhRXggPSBtb2hveW8uQ2hhcmFjdGVyRGF0YUV4O1xyXG5pbXBvcnQge2NvbmZpZ30gZnJvbSBcIi4vY29uZmlnXCI7XHJcbmltcG9ydCB7Q29uZmlnfSBmcm9tIFwiLi9AdHlwZVwiO1xyXG5pbXBvcnQge2FkZENoYXJhY3Rlcn0gZnJvbSBcIi4vc2VlbGllXCI7XHJcblxyXG5jb25zdCBtaWhveW9BY2NvdW50U3RyID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJtaWhveW9BY2NvdW50XCIpO1xyXG5sZXQgbWlob3lvQWNjb3VudDtcclxuaWYgKG1paG95b0FjY291bnRTdHIpIHtcclxuICAgIG1paG95b0FjY291bnQgPSBKU09OLnBhcnNlKG1paG95b0FjY291bnRTdHIpIGFzIENvbmZpZ1xyXG59XHJcbmxldCB7Z2FtZV91aWQsIHJlZ2lvbiwgYWNjb3VudElkeH0gPSBtaWhveW9BY2NvdW50IHx8IGNvbmZpZ1xyXG5jb25zb2xlLmxvZyhcIm1paG95b0FjY291bnRcIik7XHJcbmNvbnNvbGUubG9nKHtnYW1lX3VpZCwgcmVnaW9uLCBhY2NvdW50SWR4fSk7XHJcblxyXG5jb25zdCBCQlNfVVJMID0gJ2h0dHBzOi8vYmJzLm1paG95by5jb20veXMvJ1xyXG5jb25zdCBST0xFX1VSTCA9ICdodHRwczovL2FwaS10YWt1bWkubWlob3lvLmNvbS9iaW5kaW5nL2FwaS9nZXRVc2VyR2FtZVJvbGVzQnlDb29raWU/Z2FtZV9iaXo9aGs0ZV9jbidcclxuY29uc3QgQ0hBUkFDVEVSU19VUkwgPSAnaHR0cHM6Ly9hcGktdGFrdW1pLm1paG95by5jb20vZXZlbnQvZTIwMjAwOTI4Y2FsY3VsYXRlL3YxL3N5bmMvYXZhdGFyL2xpc3QnXHJcbmNvbnN0IENIQVJBQ1RFUlNfREVUQUlMX1VSTCA9ICdodHRwczovL2FwaS10YWt1bWkubWlob3lvLmNvbS9ldmVudC9lMjAyMDA5MjhjYWxjdWxhdGUvdjEvc3luYy9hdmF0YXIvZGV0YWlsJ1xyXG5cclxuZnVuY3Rpb24gbWFrZUdldFJlcXVlc3QodXJsOiBzdHJpbmcpIHtcclxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XHJcbiAgICAgICAgR01feG1saHR0cFJlcXVlc3Qoe1xyXG4gICAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXHJcbiAgICAgICAgICAgIHVybDogdXJsLFxyXG4gICAgICAgICAgICBvbmxvYWQ6IHJlc3BvbnNlID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVzID0gSlNPTi5wYXJzZShyZXNwb25zZS5yZXNwb25zZVRleHQpIGFzIFJlczxhbnk+O1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHtyZXRjb2RlLCBtZXNzYWdlLCBkYXRhfSA9IHJlcztcclxuICAgICAgICAgICAgICAgICAgICBpZiAocmV0Y29kZSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChtZXNzYWdlKVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVqZWN0KHJlc3BvbnNlLnJlc3BvbnNlVGV4dCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIG9uZXJyb3I6IChlcnJvcjogYW55KSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZWplY3QoZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gbWFrZVBvc3RSZXF1ZXN0KHVpZDogc3RyaW5nLCByZWdpb246IHN0cmluZykge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcclxuICAgICAgICBHTV94bWxodHRwUmVxdWVzdCh7XHJcbiAgICAgICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXHJcbiAgICAgICAgICAgIHVybDogQ0hBUkFDVEVSU19VUkwsXHJcbiAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcclxuICAgICAgICAgICAgICAgIFwiZWxlbWVudF9hdHRyX2lkc1wiOiBbXSxcclxuICAgICAgICAgICAgICAgIFwid2VhcG9uX2NhdF9pZHNcIjogW10sXHJcbiAgICAgICAgICAgICAgICBcInBhZ2VcIjogMSxcclxuICAgICAgICAgICAgICAgIFwic2l6ZVwiOiA1MCxcclxuICAgICAgICAgICAgICAgIFwidWlkXCI6IHVpZCxcclxuICAgICAgICAgICAgICAgIFwicmVnaW9uXCI6IHJlZ2lvblxyXG4gICAgICAgICAgICB9KSxcclxuICAgICAgICAgICAgb25sb2FkOiByZXNwb25zZSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzID09IDIwMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IEpTT04ucGFyc2UocmVzcG9uc2UucmVzcG9uc2VUZXh0KSBhcyBSZXM8Q2hhcmFjdGVyPjtcclxuICAgICAgICAgICAgICAgICAgICBjb25zdCB7cmV0Y29kZSwgbWVzc2FnZSwgZGF0YX0gPSByZXM7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJldGNvZGUgPT09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZWplY3QobWVzc2FnZSlcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlamVjdChyZXNwb25zZS5yZXNwb25zZVRleHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBvbmVycm9yOiAoZXJyb3I6IGFueSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgcmVqZWN0KGVycm9yKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmNvbnN0IGdldEFjY291bnQgPSBhc3luYyAoKSA9PiB7XHJcbiAgICB0cnkge1xyXG4gICAgICAgIGNvbnN0IHtsaXN0OiBhY2NvdW50TGlzdH0gPSBhd2FpdCBtYWtlR2V0UmVxdWVzdChST0xFX1VSTCkgYXMgRGF0YTxSb2xlPjtcclxuICAgICAgICByZXR1cm4gYWNjb3VudExpc3Q7XHJcbiAgICB9IGNhdGNoIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKGVycilcclxuICAgICAgICBhbGVydChcIuivt+ehruiupOW3sueZu+W9leexs+WTiOa4uOiuuuWdm+S4lOe7keWumuWOn+elnui0puaItyFcIilcclxuICAgICAgICBHTV9vcGVuSW5UYWIoQkJTX1VSTClcclxuICAgICAgICByZXR1cm4gW11cclxuICAgIH1cclxufTtcclxuXHJcbmNvbnN0IGdldENoYXJhY3RlcnMgPSBhc3luYyAodWlkOiBzdHJpbmcsIHJlZ2lvbjogc3RyaW5nKSA9PiB7XHJcbiAgICBjb25zdCB7bGlzdDogY2hhcmFjdGVyTGlzdH0gPSBhd2FpdCBtYWtlUG9zdFJlcXVlc3QodWlkLCByZWdpb24pIGFzIERhdGE8Q2hhcmFjdGVyPjtcclxuICAgIHJldHVybiBjaGFyYWN0ZXJMaXN0O1xyXG59O1xyXG5cclxuY29uc3QgZ2V0Q2hhcmFjdGVyRGV0YWlsID0gYXN5bmMgKGNoYXJhY3RlcjogQ2hhcmFjdGVyLCB1aWQ6IHN0cmluZywgcmVnaW9uOiBzdHJpbmcpID0+IHtcclxuICAgIGNvbnN0IHtpZH0gPSBjaGFyYWN0ZXI7XHJcbiAgICBjb25zdCBwYXJhbXMgPSBgP2F2YXRhcl9pZD0ke2lkfSZ1aWQ9JHt1aWR9JnJlZ2lvbj0ke3JlZ2lvbn1gXHJcbiAgICBsZXQgY2hhcmFjdGVyRGF0YSA9IGF3YWl0IG1ha2VHZXRSZXF1ZXN0KENIQVJBQ1RFUlNfREVUQUlMX1VSTCArIHBhcmFtcykgYXMgQ2hhcmFjdGVyRGF0YTtcclxuICAgIHJldHVybiB7Y2hhcmFjdGVyLCAuLi5jaGFyYWN0ZXJEYXRhfSBhcyBDaGFyYWN0ZXJEYXRhRXg7XHJcbn07XHJcblxyXG5jb25zdCBnZXREZXRhaWxMaXN0ID0gYXN5bmMgKCkgPT4ge1xyXG4gICAgaWYgKCFnYW1lX3VpZCB8fCAhcmVnaW9uKSB7XHJcbiAgICAgICAgY29uc3QgYWNjb3VudExpc3Q6IG1vaG95by5Sb2xlW10gPSBhd2FpdCBnZXRBY2NvdW50KCk7XHJcbiAgICAgICAgaWYgKGFjY291bnRMaXN0Lmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCLotKbmiLfnu5Hlrprop5LoibLkv6Hmga/ojrflj5blpLHotKUhXCIpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhY2NvdW50SWR4ID49IGFjY291bnRMaXN0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICBhY2NvdW50SWR4ID0gYWNjb3VudExpc3QubGVuZ3RoIC0gMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3Qge2dhbWVfdWlkOiBhVWlkLCByZWdpb246IGFSZWdpb259ID0gYWNjb3VudExpc3RbYWNjb3VudElkeF07XHJcbiAgICAgICAgZ2FtZV91aWQgPSBhVWlkO1xyXG4gICAgICAgIHJlZ2lvbiA9IGFSZWdpb24gPT0gXCJjbl9nZjAxXCIgPyBcImNuX2dmMDFcIiA6IFwiY25fcWQwMVwiO1xyXG4gICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKFwibWlob3lvQWNjb3VudFwiLCBKU09OLnN0cmluZ2lmeSh7Z2FtZV91aWQsIHJlZ2lvbiwgYWNjb3VudElkeH0pKVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGNoYXJhY3RlcnMgPSBhd2FpdCBnZXRDaGFyYWN0ZXJzKGdhbWVfdWlkLCByZWdpb24pO1xyXG4gICAgY29uc3QgZGV0YWlscyA9IGNoYXJhY3RlcnMubWFwKGMgPT4gZ2V0Q2hhcmFjdGVyRGV0YWlsKGMsIGdhbWVfdWlkLCByZWdpb24pKTtcclxuICAgIGNvbnN0IGRldGFpbExpc3QgPSBbXTtcclxuICAgIGZvciBhd2FpdCAobGV0IGQgb2YgZGV0YWlscykge1xyXG4gICAgICAgIGRldGFpbExpc3QucHVzaChkKTtcclxuICAgIH1cclxuICAgIHJldHVybiBkZXRhaWxMaXN0O1xyXG59XHJcblxyXG5cclxuZ2V0RGV0YWlsTGlzdCgpLnRoZW4oXHJcbiAgICByZXMgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUuZ3JvdXAoJ+i/lOWbnuaVsOaNricpO1xyXG4gICAgICAgIGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQoJ+inkuiJsicpO1xyXG4gICAgICAgIGNvbnNvbGUudGFibGUocmVzLm1hcChhPT5hLmNoYXJhY3RlcikpXHJcbiAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xyXG4gICAgICAgIGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQoJ+atpuWZqCcpO1xyXG4gICAgICAgIGNvbnNvbGUudGFibGUocmVzLm1hcChhPT5hLndlYXBvbikpXHJcbiAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xyXG4gICAgICAgIGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQoJ+inkuiJsuWkqei1iycpO1xyXG4gICAgICAgIHJlcy5mb3JFYWNoKFxyXG4gICAgICAgICAgICBjPT57XHJcbiAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gYy5jaGFyYWN0ZXIubmFtZTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQobmFtZSk7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLnRhYmxlKGMuc2tpbGxfbGlzdClcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZ3JvdXBFbmQoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIClcclxuICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XHJcbiAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xyXG4gICAgICAgIHJlcy5mb3JFYWNoKFxyXG4gICAgICAgICAgICB2ID0+IHtcclxuICAgICAgICAgICAgICAgIGFkZENoYXJhY3Rlcih2KVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgKVxyXG4gICAgfVxyXG4pXHJcbiJdLCJzb3VyY2VSb290IjoiIn0=